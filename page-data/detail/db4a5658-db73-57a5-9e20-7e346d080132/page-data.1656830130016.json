{"componentChunkName":"component---src-pages-detail-tsx","path":"/detail/db4a5658-db73-57a5-9e20-7e346d080132","result":{"pageContext":{"html":"<h1>前言</h1>\n<p>我的主力开发语言是<code>JavaScript</code>，但是 js 对多线程的支持并不是特别好。在入门<code>golang</code>后，了解到了<code>go协程</code>和<code>channel</code>，想试一试多线程。<code>go</code>原生对并发很友好，我这里是希望尝试使用<code>go协程</code>优化大数组求和。</p>\n<h1>对比</h1>\n<p>进行对比的两个函数</p>\n<ol>\n<li><code>func sum1(bigArray []int) int</code> 使用普通的数组求和</li>\n<li><code>func sum2(bigArray []int)int</code>将数组分割成若干个数组，在不同的<code>go协程</code>进行求和，所有的<code>go协程</code>都得到结果后，再进行求和</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-go line-numbers\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"math/rand\"</span>\n\t<span class=\"token string\">\"fmt\"</span>\n\t<span class=\"token string\">\"sync\"</span>\n\t<span class=\"token string\">\"time\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">for</span> i<span class=\"token operator\">:=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">10000000000</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">*=</span><span class=\"token number\">2</span> <span class=\"token punctuation\">{</span>\n\t\tduration1<span class=\"token punctuation\">,</span>duration2<span class=\"token punctuation\">,</span>result1<span class=\"token punctuation\">,</span>result2 <span class=\"token operator\">:=</span> <span class=\"token function\">runBenchmark</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span>duration1<span class=\"token punctuation\">,</span>duration2<span class=\"token punctuation\">,</span>result1<span class=\"token punctuation\">,</span>result2<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">runBenchmark</span><span class=\"token punctuation\">(</span>amout <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">int64</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">int64</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">int64</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">int64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tbigArray <span class=\"token operator\">:=</span><span class=\"token function\">createBigArray</span><span class=\"token punctuation\">(</span>amout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tstop1 <span class=\"token operator\">:=</span> <span class=\"token function\">createTimer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tresult1 <span class=\"token operator\">:=</span> <span class=\"token function\">sum1</span><span class=\"token punctuation\">(</span>bigArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tduration1 <span class=\"token operator\">:=</span> <span class=\"token function\">stop1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tstop2 <span class=\"token operator\">:=</span><span class=\"token function\">createTimer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tresult2 <span class=\"token operator\">:=</span> <span class=\"token function\">sum2</span><span class=\"token punctuation\">(</span>bigArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tduration2 <span class=\"token operator\">:=</span> <span class=\"token function\">stop2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> duration1<span class=\"token punctuation\">,</span>duration2<span class=\"token punctuation\">,</span>result1<span class=\"token punctuation\">,</span>result2<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">createBigArray</span><span class=\"token punctuation\">(</span>size <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">{</span>\n\trand<span class=\"token punctuation\">.</span><span class=\"token function\">Seed</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tlist <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> i<span class=\"token operator\">:=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>size<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">{</span>\n\t\tlist<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> rand<span class=\"token punctuation\">.</span><span class=\"token function\">Int</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> list<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">createTimer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">int64</span> <span class=\"token punctuation\">{</span>\n\tstartTime <span class=\"token operator\">:=</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">UnixNano</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">int64</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">UnixNano</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> startTime\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">sum1</span><span class=\"token punctuation\">(</span>bigArray <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">int64</span> <span class=\"token punctuation\">{</span>\n\tsum <span class=\"token operator\">:=</span> <span class=\"token function\">int64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span>value <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span><span class=\"token punctuation\">(</span>bigArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tsum <span class=\"token operator\">+=</span> <span class=\"token function\">int64</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> sum<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">sum2</span><span class=\"token punctuation\">(</span>bigArray <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span><span class=\"token builtin\">int64</span> <span class=\"token punctuation\">{</span>\n\tSmallArraySize <span class=\"token operator\">:=</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>bigArray<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n\tsum<span class=\"token operator\">:=</span><span class=\"token function\">int64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tchanGroupSize <span class=\"token operator\">:=</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>bigArray<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>SmallArraySize<span class=\"token punctuation\">;</span>\n\tsumChan <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">int64</span><span class=\"token punctuation\">,</span>chanGroupSize<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\twaitGroup <span class=\"token operator\">:=</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span>sync<span class=\"token punctuation\">.</span>WaitGroup<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> i<span class=\"token operator\">:=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>chanGroupSize<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">{</span>\n\t\twaitGroup<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">go</span> <span class=\"token function\">sumRoutine</span><span class=\"token punctuation\">(</span>bigArray<span class=\"token punctuation\">[</span>i<span class=\"token operator\">*</span>SmallArraySize<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>SmallArraySize<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> sumChan<span class=\"token punctuation\">,</span> waitGroup<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\twaitGroup<span class=\"token punctuation\">.</span><span class=\"token function\">Wait</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">for</span> i<span class=\"token operator\">:=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>chanGroupSize<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span> <span class=\"token punctuation\">{</span>\n\t\tsum<span class=\"token operator\">+=</span> <span class=\"token operator\">&lt;-</span> sumChan<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> sum<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">sumRoutine</span><span class=\"token punctuation\">(</span>smallArray <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span>ch <span class=\"token keyword\">chan</span> <span class=\"token builtin\">int64</span><span class=\"token punctuation\">,</span>wg <span class=\"token operator\">*</span>sync<span class=\"token punctuation\">.</span>WaitGroup<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">defer</span> wg<span class=\"token punctuation\">.</span><span class=\"token function\">Done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tsum <span class=\"token operator\">:=</span><span class=\"token function\">int64</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span>value <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span><span class=\"token punctuation\">(</span>smallArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\tsum <span class=\"token operator\">+=</span><span class=\"token function\">int64</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\tch <span class=\"token operator\">&lt;-</span> sum<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1>进行测试</h1>\n<p>首先我在自己的笔记本上跑了一下，效果似乎不是特别明显，当数据规模比较小时，使用<code>go协程</code>产生的开销相比多线程带来的性能提升会比较大。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5d730e63845d188002a11d0c1d51c148/a13c9/goroutine-env.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB30lEQVQoz1VSTU/bQBT0lVMPlXqJVDhUIIR39+2u7V2v10nWdvyJE0TcAE0CJEGkqlpRVeqloj+h/7myI1K6eod32NHMmxlrPho044EOjdZ9pXSSpM/Pv5+evq/Xm8fH7Xb7+f5+tdk8LJe3QRBq3d+Pr7TFKKPtY0AZAUYpB2CMcQCKEEGIYEwQgm4BALYfTKhFdhsGhDAAPbMRIRRjkFJFUVIUlTHxYGCMiYXwgTAA/g9MKe++yvpiNr78lKUFkJYzz8v5fNE0s+EwSkZpmuZC+Dt+jGFH0DK7jnP98PM4+XrwoeDZpqwvkY2kVP3+UAjpeVIIX0olpdofLKVCCFv2mT2++Dj58qeH88NT+fY0nSx/ACZleb5aret6cnV10zSz6bSJokQIPwhC3w92Kixko7Kehte/eify/dFxz46rm2+UwGiUleV5HCdZVqRpnmXFcBjtlXeyiYUx+L4y1fzNkXvw7uQQx0XdIBtF0aiqamPiPC+NiTl3hfA9T0KXSOcUaQ1DiIR6kGSTMKrStOLcQYho3V8u77Ks5Vwsbo2JbBsTQl+i6sDwEhUAZZR1ZlJCKOduEISeJ11XKKUdx3uF/B9MoW0IaevhOo7HucuY07XF4dwFYJy7u/68Bv8FvnyXMtX46VwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"env-mbp\"\n        title=\"env-mbp\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5d730e63845d188002a11d0c1d51c148/fcda8/goroutine-env.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5d730e63845d188002a11d0c1d51c148/12f09/goroutine-env.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5d730e63845d188002a11d0c1d51c148/e4a3f/goroutine-env.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5d730e63845d188002a11d0c1d51c148/fcda8/goroutine-env.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5d730e63845d188002a11d0c1d51c148/efc66/goroutine-env.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5d730e63845d188002a11d0c1d51c148/a13c9/goroutine-env.png 1178w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">数据规模 sum1函数耗时(ns) sum2函数耗时(ns)\n1000\t1000\t257000\n2000\t2000\t196000\n4000\t3000\t123000\n8000\t19000\t566000\n16000\t24000\t574000\n32000\t21000\t106000\n64000\t46000\t101000\n128000\t92000\t117000\n256000\t161000\t164000\n512000\t710000\t354000\n1024000\t633000\t380000\n2048000\t1855000\t746000\n4096000\t3779000\t1430000\n8192000\t9285000\t7126000\n16384000\t17107000\t7522000\n32768000\t37100000\t16824000\n65536000\t71186000\t28741000\n131072000\t153552000\t55689000\n262144000\t349672000\t125364000\n524288000\t3370025000\t221678000</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aca2cf40592d09bc58c726fab21b0a62/6f969/goroutine-bench1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.405405405405407%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVQY042RbQoDIQxEe/8D7jXK0vqRycQp7oprWwr9MeSZyCPizd0VET/TWhOAI53fZ5Nj1O1WaxXJr8v/xBmqoLgKzWxusm71yW1yk5OCn0Ke/Rj3+oaX8GgudXKEyBAYsiFaZ114PbkUOUx0l4+sbIAMLoxzkAr6DM8/uIS96TULVlVyVklJMFMtWSUnhUPpseu536Vw0aqsJDVCxOB2Cs1sewHDy9i7q3paAgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bench1\"\n        title=\"bench1\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aca2cf40592d09bc58c726fab21b0a62/fcda8/goroutine-bench1.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aca2cf40592d09bc58c726fab21b0a62/12f09/goroutine-bench1.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aca2cf40592d09bc58c726fab21b0a62/e4a3f/goroutine-bench1.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aca2cf40592d09bc58c726fab21b0a62/fcda8/goroutine-bench1.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aca2cf40592d09bc58c726fab21b0a62/efc66/goroutine-bench1.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aca2cf40592d09bc58c726fab21b0a62/c83ae/goroutine-bench1.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aca2cf40592d09bc58c726fab21b0a62/6f969/goroutine-bench1.png 2518w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<hr>\n<p>后面我使用了一台 8 核 16GB 内存的云服务器进行测试，效果就比较明显了。sum2 函数的耗时明显降低。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">processor\t: 6\nvendor_id\t: GenuineIntel\ncpu family\t: 6\nmodel\t\t: 85\nmodel name\t: Intel(R) Xeon(R) Platinum 8255C CPU @ 2.50GHz\nstepping\t: 5\nmicrocode\t: 0x1\ncpu MHz\t\t: 2494.140\ncache size\t: 36608 KB\nphysical id\t: 0\nsiblings\t: 8\ncore id\t\t: 6\ncpu cores\t: 8\napicid\t\t: 6\ninitial apicid\t: 6\nfpu\t\t: yes\nfpu_exception\t: yes\ncpuid level\t: 13\nwp\t\t: yes</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">数据规模 sum1函数耗时(ns) sum2函数耗时(ns)\n1000\t975\t184791\n2000\t1744\t136564\n4000\t2452\t77209\n8000\t4462\t148065\n16000\t13041\t151411\n32000\t17729\t99903\n64000\t34824\t88240\n128000\t72507\t88009\n256000\t153425\t118217\n512000\t307149\t128954\n1024000\t716739\t218762\n2048000\t1498043\t340398\n4096000\t3121459\t741179\n8192000\t6512778\t1440240\n16384000\t12999638\t2841228\n32768000\t25421817\t5573615\n65536000\t52787702\t11216755\n131072000\t102977136\t22564239\n262144000\t212568740\t48269912\n524288000\t408104714\t90059294</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b1cec0dafb23b4248a54b152b15a0c2f/27f8b/goroutine-bench2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVQoz21SCY7DMAjM//+6ddr44PSsIHGVVkVCEI7BM8omIiAiuPtPn3Oi947WWuYfvSvarbYFYAyv5TvQysPiOwBw1c0coo7BCrWYvwDHGCilwMyuQfvI3S2BVC2dxNBZEkiyprdZx1ZrRfh6zWrExcjVLJfDSfQEtvPItwQJGPoFYDTDohgUOOiIgdShPlOnpJ0zE55gBlPJ+AZkZuzlASbCGIyeTmAWmAicO4zaFb981YRT0zi4xcOUBur+gIyGfuyQ9sKUgX48IUyYbqjHARWGm6LVCkvtJlrvb6nib9hCq7slrZP9SWsCgwXP8pfaLVnmOZx0116A/gNAl3ZBcfoNpAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bench2\"\n        title=\"bench2\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b1cec0dafb23b4248a54b152b15a0c2f/fcda8/goroutine-bench2.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b1cec0dafb23b4248a54b152b15a0c2f/12f09/goroutine-bench2.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b1cec0dafb23b4248a54b152b15a0c2f/e4a3f/goroutine-bench2.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b1cec0dafb23b4248a54b152b15a0c2f/fcda8/goroutine-bench2.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b1cec0dafb23b4248a54b152b15a0c2f/efc66/goroutine-bench2.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b1cec0dafb23b4248a54b152b15a0c2f/c83ae/goroutine-bench2.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b1cec0dafb23b4248a54b152b15a0c2f/27f8b/goroutine-bench2.png 1730w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1>分析</h1>\n<p>在求和数组规模数据规模比较大，运行的机器核心数比较多的时候，使用<code>go协程</code>是可以提升数组求和的效率的。<code>go协程</code>和系统的进程并不是一一对应的，创建一个<code>go协程</code>本身的开销也比创建一个线程小。对大数组求和只是一种场景，也有很多其他类似的场景可以利用<code>go协程</code>进行优化。</p>","id":"db4a5658-db73-57a5-9e20-7e346d080132","headings":[{"value":"前言","depth":1},{"value":"对比","depth":1},{"value":"进行测试","depth":1},{"value":"分析","depth":1}],"date":"Monday, July 27, 2020 1:11 PM","tags":["go","随笔"],"title":"使用go协程优化求和算法"}},"staticQueryHashes":["63159454"]}