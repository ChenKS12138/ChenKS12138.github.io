{"componentChunkName":"component---src-pages-detail-tsx","path":"/detail/74cae60c-b765-5b90-9558-c1181bfe45f2","result":{"pageContext":{"html":"<h1>前言</h1>\n<p>HTTP 层的数据传输对于 web 开发人员来说是一个黑盒，但是平时的开发又离不开它。因此有必要去了解一下它是如何保障我们的数据可以被高效、准确地传输。</p>\n<h1>连接模型</h1>\n<p>抓包使用环境</p>\n<blockquote>\n<p>macOS 10.15.7</p>\n<p>Nginx 1.18.0</p>\n<p>Chrome 86.0.4240.80</p>\n<p>Wireshark Version 3.2.4 (v3.2.4-0-g893b5a5e1e3e)</p>\n</blockquote>\n<h2>短连接</h2>\n<p>短连接是 HTTP/1.0 默认的连接模型，使用它意味着每进行一次<code>请求-响应</code>就需要完成一次 TCP 三次握手和四次挥手。</p>\n<p>Nginx 配置</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">\nworker_processes  1;\nevents {\n    worker_connections  1024;\n}\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    tcp_nopush     on;\n    keepalive_timeout  0;\n    server {\n        listen       80;\n        server_name  localhost;\n\n        location / {\n            root   /usr/share/nginx/html;\n            index  index.html index.htm;\n        }\n\n    }\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/8a88b4c549f9b793b1819a5df75c62ae/e8d6f/http-connection2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACSUlEQVQ4y62Sz08TURDHnxf1KC2k/kogUTDRqBdvknCAhCORQJEfIoiKJwLhXzCu/ieevJnYhPODQkuA7tKgJCbIUtvudrvtdrf07Xtf8ratqWgkRif57JuZnXx3ZvaRno6r17tvXnt7++595VbPnTednTeUrq5upS0UUS61dSihcEQJhS8r4XZJpBHXc01fvguFI+/aO650kUdDw33z86+wuLiMhYUlzD57gZmZOUxNPcXk5DTGxiYwGh3HyOg4RqITiI5NIBodx2j0ceA/mZ7F0tIy5p6/xNDQ8CBJJJO9qBv7HW6xyKxiidl2iX39lmEHh0csn88z0ywwwzSZ4zjMrbjMsizE4/F+kkwme33fhxBCcM5/wfM8UbAsUSgXRc4yRdG2g1zFdUXV9YRTLot8qSCscgl0lQ6QRCIRCAKBpjTpyDA4yxUPjluF41VRdCpwXK+eczwYtg3dNoXploVdcbG2lhwIOuSc/xBsOPIBGXzP5mEYJo6rx8hmc5CjGaaJXDaHAyOD/VJGiCoTNKPi9af3fxAE4HOB4xqDzxhkDWMMchpJrVYLPioHkasxPBsr8Y2zBSWtudazQX0/HFhPpM4WZP7PArK29WwKMt/H6sb233XYymlBuYbVxHbwlx82ro1/GubzADRiznlA0xeCN2tZo8N+srW11Yf/ZOub6iCJxWL3dF1f03WdnuZQP6K76c9U1dJ0J6XRlKrRHVWjqrZLt7U9upH6Qje1fZpW03RP3Y1/+LjygBBCzhFCzhNCLv4jF6TWCdyccKsJUNEQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"short-connection1\"\n        title=\"short-connection1\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/8a88b4c549f9b793b1819a5df75c62ae/fcda8/http-connection2.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/8a88b4c549f9b793b1819a5df75c62ae/12f09/http-connection2.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/8a88b4c549f9b793b1819a5df75c62ae/e4a3f/http-connection2.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/8a88b4c549f9b793b1819a5df75c62ae/fcda8/http-connection2.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/8a88b4c549f9b793b1819a5df75c62ae/efc66/http-connection2.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/8a88b4c549f9b793b1819a5df75c62ae/c83ae/http-connection2.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/8a88b4c549f9b793b1819a5df75c62ae/e8d6f/http-connection2.png 1273w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1df0278412925ef00667f8bcbc4e66f5/29114/http-connection1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVQoz43La2+iQBSAYf7/79mqBa2o5SbMcB0sC4oCAzjcukarLYVparNmN7sf+ubJJOecDDMJJNYXpL0hZFDM9QUGEjHGa/HeW4wDkQsE1n/k/EcuEGbRchqpYq7LhSkX5nLvMF7Dr+ppSWH+viSdlrzJFYWragrxyMxZm3ConNhkbO255PXzVFJww6BqZhV82sPoTY3ftfCipD20Cl6J7qVwKIZDaTsS1gNhPTD2D5sXOW61tIdfGLea2SWfURi3Ku607UXJKHRKXtmNtISFKQcwpyUswByqZ8FRxB3IKPzCuPXc+fysx62GOxCelYzqTjlbRqyRP9hkumoWbj136zlutZzq2R8YVPEmmaRUi1ol6ZbhRUqpZhUTeTcQt3fC5ocaj5TdUNze+cdFTkFKtRtm8wv8rNWiX+WtQzo3fXVK+hQ0AOWSnYoWFlZERnvJycT4bFXUK+nTDUP/U3/1e+j7/vr8GxOGIULI8zzf95MkIYQ8Pz+fTqfjN2KyLMMYE0KapjkcDufzS9d19Hsxug50XTdN03VdhJBzzf47x3EMw1BVFUJ4WwIAPgCHeEXCGFiETQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"short-connection2\"\n        title=\"short-connection2\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1df0278412925ef00667f8bcbc4e66f5/fcda8/http-connection1.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1df0278412925ef00667f8bcbc4e66f5/12f09/http-connection1.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1df0278412925ef00667f8bcbc4e66f5/e4a3f/http-connection1.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1df0278412925ef00667f8bcbc4e66f5/fcda8/http-connection1.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1df0278412925ef00667f8bcbc4e66f5/efc66/http-connection1.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1df0278412925ef00667f8bcbc4e66f5/c83ae/http-connection1.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1df0278412925ef00667f8bcbc4e66f5/29114/http-connection1.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>上图中打开了一个网页，同时这个网页需要加载 index1.js index2.js 这两个资源。从第二张图片中的抓包中可以看出<code>141-152</code>完成了对<code>index.html</code>数据的请求，<code>153-176</code>完成对 index1.js index2.js 资源的请求。<code>153-155</code>和<code>157-159</code>浏览器从不同的端口向 Server 发起了两个三次握手。</p>\n<h2>长连接</h2>\n<p>长连接是 HTTP/1.1 中新增的一种连接模型，HTTP/1.1 中默认就是长连接。使用长连接，完成一次 HTTP 的<code>请求-响应</code>后不会立即关闭 TCP 连接，TCP 连接会存活一段时间，如果这段时间内没有新的 HTTP<code>请求-响应</code>则会关闭 TCP 连接。TCP 三次握手、四次挥手开销都比较大，使用长连接可以避免一部分不需要的 TCP 握手挥手。</p>\n<p>Ngnix 配置</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">\nworker_processes  1;\nevents {\n    worker_connections  1024;\n}\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    tcp_nopush     on;\n    keepalive_timeout  65;\n    server {\n        listen       80;\n        server_name  localhost;\n\n        location / {\n            root   /usr/share/nginx/html;\n            index  index.html index.htm;\n        }\n\n    }\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/68279aef08d0a456c02db074e088011c/e8d6f/http-connection4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLUlEQVQ4y62RW2sTQRSAxxf10eZC6gUa0FZQ1BcfC31ooY/B0iYkrbW1an0qDf0Prv6f+hBLUWu6rSGBCNkssYpgXdpk792d3SSTnSOzuRBrpIgOfJxz5sx+nJlFY+Er10ZvXH1568497ubY7RcjI9e5aHSUGwpEuEtDYS4QjPgEQ8NcMBTp1YHg8C+9QDDyKhS+HEUPYjMTq6vPYX19A9bW0rD8+CksLa3AwsIjmJ9fhEQiBXPxJMzOJWE2noJ4IgXxeNLfY/nDxWVIpzdg5ckziMVmplE+nx+H9iKDcA2D6IZFTNMi3w6PyaF0RBRZJpqmEVXVCLYxcbBDdF2HXC43iQqFwnir1QJKKfU87zdcx6WyrlHNMqhuGNQ0T6jrutS2McUYU8XSqWqZ1DyxIJvdnfInZEIA38kW9OM4Djh1B5xGHbDjgOu67T3sQM1UoYp1ihsurdsu7O/uTfkTep7XE3YS6KRQq8mgKCo06g04rlaBXU1RVZCrMnxVfkDVNqiNLfr2SICtN+/+LOxGQogPO8Miuw2j2WwCeNQ/1PJa9DuWYWt7+2xhfz6o1/mGggeQ28meLez0egJW98eukE2/9/7D3wtPi7tC9gy+sPuX2VOcxvM8n0F1O/Z6pD3hziQqFosT8D8WpZDL8tMok8nclSRpX5IkfhCVSoUXRZEvCQIvdBDFMl8qV/hC6YD/VP7Cfy6L/IEgfNzcfH0fIYTOIYTOI4Qu/iMXmOsnRQdwrrH0ge0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"long-connection1\"\n        title=\"long-connection1\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/68279aef08d0a456c02db074e088011c/fcda8/http-connection4.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/68279aef08d0a456c02db074e088011c/12f09/http-connection4.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/68279aef08d0a456c02db074e088011c/e4a3f/http-connection4.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/68279aef08d0a456c02db074e088011c/fcda8/http-connection4.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/68279aef08d0a456c02db074e088011c/efc66/http-connection4.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/68279aef08d0a456c02db074e088011c/c83ae/http-connection4.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/68279aef08d0a456c02db074e088011c/e8d6f/http-connection4.png 1273w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bfb2a06b64b090f11c1146dc9da18464/29114/http-connection3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOUlEQVQoz5XO7W6CMBQG4N7/BS3TxQ3mIiotiMpHGBkIpdgKSHWIBqHL3JaYLUb35M35c3JOXjBPBkbUD6uJ/46CUvc4DKuJQfrq4kmLJA3LKJJgKKFIMlcDt1AXOz06GNHBiKsZcPiLmUtLoeEakgYF++FSaPNUUnFnyh7ttWyvn61cNjM52A/jBpIWLYX2FWDlskF7RMCwHuHj+K1SiIBT1lOCu3F4D3EHkQcUdyHp2oXsVwpuVCLgKQj4G+01V1Ph0KPJGjs+zFLhuLlqUsWiirMaBVvd3+r+RmONnQknPQsQ17SfvucvoBXtpaurf0F7RvwTuFz1OhAEgWVZrut6nocxZoxxzne7XXkDQAjBGFNKsyzjnJdlWdf1rbUpTSilabrinBdFsT7J/2CMxXFMKf3ZZkmSfACz0Gg3wy9engAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"long-connection1\"\n        title=\"long-connection1\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bfb2a06b64b090f11c1146dc9da18464/fcda8/http-connection3.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bfb2a06b64b090f11c1146dc9da18464/12f09/http-connection3.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bfb2a06b64b090f11c1146dc9da18464/e4a3f/http-connection3.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bfb2a06b64b090f11c1146dc9da18464/fcda8/http-connection3.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bfb2a06b64b090f11c1146dc9da18464/efc66/http-connection3.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bfb2a06b64b090f11c1146dc9da18464/c83ae/http-connection3.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bfb2a06b64b090f11c1146dc9da18464/29114/http-connection3.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>可以观察到上面的抓包结果中<code>52</code>完成对 index.html 的 HTTP 请求后，TCP 连接没有立即关闭，后面请求 index1.js 时，复用了这个 TCP 连接节约了 TCP 握手挥手的时间开销。TCP 连接的性能只有该连接被使用一段时间后才能得到改善，这个是 TCP 的慢启动机制、流控机制导致的，使用短连接，慢启动机制、流控机制还没来得及起作用，连接就已经关闭了。但是也要注意到，保持这个 TCP 连接是会消耗服务器资源的。</p>\n<h2>流水线模型</h2>\n<p>流水线在现代浏览器中默认是不开启的，它的大致思路是允许在同一个长连接上发出连续的请求，请求不再需要等待上一个请求的响应到达，在高延迟网络条件下可以降低网络回环时间降低延迟。但是使用流水线存在着一些问题和限制，我们需要保证在这个 TCP 连接上响应和请求的顺序是对应的，否则我们无法将<code>请求-响应</code>正确关联起来。同时还有 HOL 问题，如果前面的响应延迟了就会阻塞后面的请求的响应。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7f90a65d6b96cce16dcbcd080f0aaaaf/ad997/HTTP1_x_Connections.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD00lEQVQ4y11SbUxbZRQ+3NuW6xhBujIEEaS9pczSrrelHZaJwQYJuMCcWXQzgksTtkwsc2rUqPsxZbgQl7HxMYQ5ZHMoHSBQmF84LBU6QCiUUvpJKS0Ko4hK2GAxr7l3+MeTPHnf95zzPs85OQdEoidiqi+0KCfGQ6J5P+J3tA0qjh19SwwAYZpn8h79/LIh3enYIP0+JLh29Xvly4dLSIQQHHpJK9C3DqisE3+mjo3eETc2dGbm5b/wONA2bA6c7fvB1mTsd9UPmmabvO77mZOWEMxMr3GHBv0Xb/U5Puu/5bxkHgpc8vtQinXiD7Db/iYHjJ6G/p+ctcZ+d92vI4uV66soGng7YgGhdUBoGlZXR4BWLyw8nKBW59JaGP2msbmBICIKiFKdLrH4SBEdY9FdAACbjpNpgke0urIE4BAYOBxVcp+vVmW1Viq83lq1+XadoP/n8/Dcvmx2bm7+9qMlx4kibSnnlO44ca6saPt72oOgyd4bfvKNYxF1jdXE+dJsouj0FcHz54wiRt03O+6zTw+iadvQpsc9itZWPa96XcNQcebDcJVqD+tgcQn2vhiwtBP1kdzy0Z1QWMFU+KB6P6DFLogFYFkTs+MZwl6DR6P/2lLQ2+3M7+r27K/r8NJDYWc8lcfOysoiDh3Rst5OI3DR2d6IuKtzOwEAd7j1gmCwozIQaP/Y779RvrrSc+pusJXHDGXtr/swNekAy0wQELoHcGIsbjcXj+bEkZysrKeJFw8c4Dz2ug6vFqVsa4vl0Z+ifM6WHQvBjlybrTnHMn752cWlLs3c790RYBwwQWD+Zr3PZ2h3Ob+5Hgzc7NxcN2kW5nvhzZPFnMjIWFYSS4ABcMPaU1WRd5Kp+B9ZCUwhKysGmJr6AkZGGgChAcbHtDxpcRp+MY1ODZsnbo+N2a2e+dB+f3AW/PM9MYuLnY1ez1fNM/ZrTcshw5VNZE5dRyY4feY1ttFYg7td1zH/XCum15fjOTl7sS1SOyBUBwhdYAS+BW58ezgfKnWvsBEy8RAajkFolLdxty/2u7ZPiC8bPgBVOoULhSlAg88X0Ajj8wUYFBYUgM3WLF9e7lIuLHUqfnO2ZC5VvZvirnoH9smk+INJTgJCFkZsa/cgKSkZJ0khpAp3QUb6kzRxGEmSGJMUCvV8NDd3o8blavl0aamr5h9kzriHBqCisowF/zO1WoFRlARIUogpZWpIIUUgEUtBvUfD+GBXciKdx6ZX4b/N37ozh1Qqi5JKqWiZdHekTEpxJRI5Lk6jIF2uBDmleEhBKR6WSSmeREJtU6ZnwL/OJ8Ri1oIv7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"HTTP1_x_Connections\"\n        title=\"HTTP1_x_Connections\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7f90a65d6b96cce16dcbcd080f0aaaaf/fcda8/HTTP1_x_Connections.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7f90a65d6b96cce16dcbcd080f0aaaaf/12f09/HTTP1_x_Connections.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7f90a65d6b96cce16dcbcd080f0aaaaf/e4a3f/HTTP1_x_Connections.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7f90a65d6b96cce16dcbcd080f0aaaaf/fcda8/HTTP1_x_Connections.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7f90a65d6b96cce16dcbcd080f0aaaaf/efc66/HTTP1_x_Connections.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7f90a65d6b96cce16dcbcd080f0aaaaf/ad997/HTTP1_x_Connections.png 1012w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>多路复用</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b14851cf989877daf6ba7067471b36ed/35751/http2-binary-layer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGUlEQVQoz1XS7U/aQBzAcf77vTGLy5YFky2OCBrj4qhOxoNQBoJKbaEclILiA9KWFtvecS135aG3UM2yfXIv7vfim1zuLjZqtbVubwy6IxlY9w/r9RpCiCMIIUppEKH/8HwfQkgpjZ1tvct83Cp8/lD89L51wqEZtiyTMWZZVqVSAQCoqqooym1kEPEjCKHY8HeqU/wm53f7fEKtZjXNcBybMWYYRjwe34lsb28fHR1Vq9VarX5R4ZGtr9YhxjgGWpLSkbvtJmiJA7UXBAFCiDFmmmYymUxEUqkUx3G5XE6SmqJwPZsMl2SGsRe7aEiC3LmS5JrQlDsKpfQ11gw9k8mcnp6m02me50VRFCKNRmPmWG/xoTDe4zuJEji4eiwrE0rmHsbz9eLeGPHlcrFYKpV4UWreiJIoRavZ9DFczhH2/FiiDvYv2/uX8t4lyMl9SgnexAHCqK+Aif7sIQfDl5k7dW3TnhquMw1Xi8BzNnGyW/hS+7FT+Z7s5PODK0qIN8NztrLNZwhOgrvcY/3g5iw+rKbsNrcYFlDvFzbvl8TbHPt8IBTVxrlyXRzciI/KIgheY10fuvKx3zsxhEO19PWpnnTkY6+btmUOI2e1Wm1um4XsTbRZLpe2bS/C9d2T4nR/ktv8i8yBwu5D/cDrZ/1+1u3lIEKEkM07s/+FYei67uZ7QahrY10bG7o2tQxzYvwdEUIQQkLIH5rdNs8Nnx1vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"http2-binary-layer\"\n        title=\"http2-binary-layer\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b14851cf989877daf6ba7067471b36ed/fcda8/http2-binary-layer.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b14851cf989877daf6ba7067471b36ed/12f09/http2-binary-layer.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b14851cf989877daf6ba7067471b36ed/e4a3f/http2-binary-layer.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b14851cf989877daf6ba7067471b36ed/fcda8/http2-binary-layer.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/b14851cf989877daf6ba7067471b36ed/35751/http2-binary-layer.png 873w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>HTTP/2 在 HTTP 和 TCP 间增加了一个二进制分帧层，有必要先理解几个概念</p>\n<blockquote>\n<ul>\n<li><em>数据流</em>：已建立的连接内的双向字节流，可以承载一条或多条消息。</li>\n<li><em>消息</em>：与逻辑请求或响应消息对应的完整的一系列帧。</li>\n<li><em>帧</em>：HTTP/2 通信的最小单位，每个帧都包含帧头，至少也会标识出当前帧所属的数据流。</li>\n<li>所有通信都在一个 TCP 连接上完成，此连接可以承载任意数量的双向数据流。</li>\n<li>每个数据流都有一个唯一的标识符和可选的优先级信息，用于承载双向消息。</li>\n<li>每条消息都是一条逻辑 HTTP 消息（例如请求或响应），包含一个或多个帧。</li>\n<li>帧是最小的通信单位，承载着特定类型的数据，例如 HTTP 标头、消息负载等等。 来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识符重新组装。</li>\n</ul>\n</blockquote>\n<p>多路复用可以实现在一个 TCP 连接上传输多个<code>请求-响应</code>，并解决了 pipelining 中对响应返回顺序的要求。</p>\n<h1>小结</h1>\n<p>从上面的 HTTP 协议的发展中可以看出，这方面的优化主要是朝着减少不必要的 TCP 报文，降低网络延迟的角度进行。如今网络带宽越来越高，网络加载的性能瓶颈更多的是出现在了延迟上，pipelining 和多路复用想解决的都是这个问题。</p>\n<h1>参考引用</h1>\n<ul>\n<li>[1] <a href=\"https://developers.google.com/web/fundamentals/performance/http2?hl=zh-cn\">https://developers.google.com/web/fundamentals/performance/http2?hl=zh-cn</a></li>\n<li>[2] <a href=\"https://juejin.im/post/6844903853985366023\">https://juejin.im/post/6844903853985366023</a></li>\n<li>[3] <a href=\"https://hpbn.co/primer-on-web-performance/#latency-as-a-performance-bottleneck\">https://hpbn.co/primer-on-web-performance/#latency-as-a-performance-bottleneck</a></li>\n<li>[4] <a href=\"https://http2.akamai.com/demo\">https://http2.akamai.com/demo</a></li>\n</ul>","id":"74cae60c-b765-5b90-9558-c1181bfe45f2","headings":[{"value":"前言","depth":1},{"value":"连接模型","depth":1},{"value":"短连接","depth":2},{"value":"长连接","depth":2},{"value":"流水线模型","depth":2},{"value":"多路复用","depth":2},{"value":"小结","depth":1},{"value":"参考引用","depth":1}],"date":"Friday, October 23, 2020 3:25 PM","tags":["随笔","计算机网络"],"title":"HTTP连接模型"}},"staticQueryHashes":["63159454"]}