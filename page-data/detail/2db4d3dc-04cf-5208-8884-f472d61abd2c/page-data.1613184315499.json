{"componentChunkName":"component---src-pages-detail-tsx","path":"/detail/2db4d3dc-04cf-5208-8884-f472d61abd2c","result":{"pageContext":{"html":"<h2>前言</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/c60b0c816cc71eda2e7d9da6c997803b/af192/collect-homework-first-version.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvklEQVQI113NzQ7BQBQF4L4CyrRm7vx12upfZugUpShWEhtbsfD+T2GERCL5cnLv4uR4IRAqhEwimXAqgTBCGIDAmBEQBDgG7l5AmI4Q8wOX1A/YOOSO13ZWL6pCF7u+btZVf97u++X+aNddszusDqfN3OamLrJSx5mJM5caRPrpe1xVAVZRqkvTpnk9K200M4k7CutUpp1MI4RVSNSUqhDeEJbf5cv1dn88ZVJylYs4HyEYTn4GY+JG/nyazgu8kCIwlazKaAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"first-version\"\n        title=\"first-version\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/c60b0c816cc71eda2e7d9da6c997803b/fcda8/collect-homework-first-version.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/c60b0c816cc71eda2e7d9da6c997803b/12f09/collect-homework-first-version.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/c60b0c816cc71eda2e7d9da6c997803b/e4a3f/collect-homework-first-version.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/c60b0c816cc71eda2e7d9da6c997803b/fcda8/collect-homework-first-version.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/c60b0c816cc71eda2e7d9da6c997803b/af192/collect-homework-first-version.png 645w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>大一上时刚学会点 php，然后自己是学习委员，作为学习委员需要经常收电子版的实验报告，从 QQ 上将实验报告一份一份下载很麻烦，为了提高效率就萌生了写一个提交作业的网站的想法。在这里我第一个使用 mysql+php+python 搭建了一个项目，现在回头看，之前写的代码确实不怎么好。没有一个管理后台，每次有需要收新的实验报告时都要改代码。不够安全，由于不清楚如何使用 php 发起 smtp 邮件请求，就采用了使用 exec 函数调用 python 程序发送邮件的方案。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/eca0b60e05629ee92bc6b9cc521306d0/29114/collect-homework-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABQ0lEQVQoz5VQuU7DQBB1jSxQBEpBiUTBJxFMbGKQEIdSU/AP8AMc/5BslAByKgTITaCBxkeEoaJwYG3Ze7EHCYedgtHTSKN3zOxqVXtrvmEvNOyKaeq1Nb1m6EZdr1tL2zsru3vVDXvOtCqmNWusS1ZgZrW2aG8u7ze1lue1fIG27wOO4RAMBuDq8uyid+o4J/3+MWgf9brnrtsJQxAECp0wAL6nsWIRwrKMwiR4erx1uvHrC8tzinFRqBFKi6A8gbIb9/rwwI6eA66jZTJNEZhvYwxjLESE5FnOxygKH+7v3kexoAiRLEMIKYvYrA7gBJG06lyBxUBV7tc4ZlV9m1WYKpFFaY5QmmWZ9CF50YRV/Zf5Z2F5PPdOsmiZbIqZW6WfiL8Ql//PzHsCk7d4ROVYunvq2UmaQgg/IOSvJuPX/qlPvJpRVD/gp0wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"collect-homework-second-version\"\n        title=\"collect-homework-second-version\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/eca0b60e05629ee92bc6b9cc521306d0/fcda8/collect-homework-2.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/eca0b60e05629ee92bc6b9cc521306d0/12f09/collect-homework-2.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/eca0b60e05629ee92bc6b9cc521306d0/e4a3f/collect-homework-2.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/eca0b60e05629ee92bc6b9cc521306d0/fcda8/collect-homework-2.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/eca0b60e05629ee92bc6b9cc521306d0/efc66/collect-homework-2.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/eca0b60e05629ee92bc6b9cc521306d0/c83ae/collect-homework-2.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/eca0b60e05629ee92bc6b9cc521306d0/29114/collect-homework-2.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>后来大一下学会了点 Vue.js Node.js ，进行了重写了，使用了 ElementUI 这个组件库，解决了上一版的两个主要问题，了解到了 session、cookie、可以使用 gzip 这类压缩算法压缩 HTTP 响应，加快响应。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/e062006ddd516b02b3fa7405273e620e/29114/collect-homework-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABQklEQVQoz52OXUsCQRSG91dkRlBUSqBQKYTedFN/t8suchG1iDBNdCP8qu5z0d2ZOfOlrtuZXdG6EXJ4OLznnPedGeswWzzIFLAmU7nE8XnMXjq/m8qlc1fZwnUynUcSJxer7c7R2X6meHp5YzU63Ua7i7Xp9JBXp9/s9MqP9Xu7VrZrD5Unu1S1q8/11nvrbRAbjMfpv7R7ltIzRKo/UBCcq8/hsHR3SylQJoScSrStnVNMWR6BiUco48Cl51MU44mPQqjpyHUHgy6XGlcIocbJuPQJQ5tPwPIpl1IGQRCGodYahVIKBbZzc3AQLKKDjZIqDBdf47meBQDChPEdBvgxHb9PgaMQQuMw+hRwoRCzwpFUHyNJADU3YZMnEMF/VfDi1XoLsZOxpV6G/wXeHottwis2hQkTyJZhd+x/u5MNhh8RqDpU0LrH6gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"collect-homework-3\"\n        title=\"collect-homework-3\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/e062006ddd516b02b3fa7405273e620e/fcda8/collect-homework-3.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/e062006ddd516b02b3fa7405273e620e/12f09/collect-homework-3.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/e062006ddd516b02b3fa7405273e620e/e4a3f/collect-homework-3.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/e062006ddd516b02b3fa7405273e620e/fcda8/collect-homework-3.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/e062006ddd516b02b3fa7405273e620e/efc66/collect-homework-3.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/e062006ddd516b02b3fa7405273e620e/c83ae/collect-homework-3.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/e062006ddd516b02b3fa7405273e620e/29114/collect-homework-3.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>现在大三了，国庆期间又重写了代码，后端部分的代码试水了 golang，postgres，golang 有 python 的开发效率，有接近 C++的性能。我觉得这门语言设计者是个十足的偏执狂，golang 在代码格式的要求上要求很严格，<code>else if</code>是不换行的，代码格式不正确，编译不通过。前端部分，使用的技术栈是<code>react</code>+<code>redux</code>+<code>redux-saga</code>+<code>saga-duck</code>+<code>antd</code>，在实习期间了解到了<code>saga-duck</code>这个库，和<code>dvajs</code>有点类似，但是在与 typescript 的契合上更优，duck 间不仅有继承关系，还有组合关系。saga-duck 是使用了 ducks 模式管理了 redux 相关的一些代码，避免代码过于分散。在使用时，我没有使用官方的<code>duckRuntime</code>连接<code>redux</code>，我自己写了一个<code>useSagaDuckState</code>的 hook 函数，我认为并没有必要把所有页面组件级别的<code>state</code>都放在<code>store</code>中，使用<code>saga-duck</code>更多的是希望管理好当前页面的<code>state</code>，因此使用一个通过调用<code>useReducer</code>创建页面组件级别的<code>store</code>的<code>useSagaDuckState</code>的 hook 函数可能会更加符合场景需求。</p>\n<p>期间我也了解了 jwt、HTTP 缓存、webpack、docker 这些技术，尽管使用了一台带宽更小的服务器（1Mbps），但是加载效果依然不错。</p>\n<h2>服务端的配置优化</h2>\n<p>这部分的优化主要是在服务端的 nginx 中，通过配置资源类请求的响应头，来实现缓存。可以通过增加 <code>expire</code> <code>cache-control</code>这类响应头字段来使客户端对资源进行缓存，减轻服务端压力。<code>expire</code>可以规定资源的到期时间，在到期时间前，会直接使用缓存。使用<code>cache-control</code>响应头可以规定资源的缓存时间长度。同时，通过浏览器可以通过资源请求响应的 e-tag，和服务器端确认资源的新鲜程度。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/75c9e3b4bc95a266447227a14548be1a/47ff6/collect-homework-http-cache.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 117.56756756756756%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsSAAALEgHS3X78AAACMUlEQVQ4y+2USW7bMBSGdYKiiy4zWeI8STIlSqImK3ZsyQayqZFl0V2BLnuAnqAXyG37bKWp2132eRCE7/18A0mQDOI0b7vBmJhSVjjXdb33bVXVXbvKsqIsvXMVKMDWurKsi6LSOknTzNo8sLbQJtFK9/2w26zH3W77MPbd4Ku6qdum7vKscHnZNJ1z5TLNoBCIUChJbOB8uRmn2DrMpS1q51umYp3YuhtUYqVJfTdYVwmduKqBUanM0lrvG85FsGARUpKoJOIKCYWlCZkEJiqGPzBRBgl9RzkAVuYOE6Y04wxjHDDCCSaUEEYoTD5NUkaZ4MJoTUGB9cWnRcUmxggBVNZpk1IupdTBZvOw3Y19vxJCOtiNyhNCgff7A7hZlq9Wg5RKKd11K981auq5UhKFxN4Hj4+PT09Px+NxHEfvvc0yhBBjbJomaFuWJeigCCmmcV8P1Yef3z/+eP707dfV/ZfgcDhst9uiKIQQGTTK8yiKgPu+B4Dkz8djAjtrs/V642sflSZst4t2f7X+GlBKF4tFGIYQCg3BhT4Epn4GUKA/8DzKOaeLiNxe09ur22QdzKGzwQaCi/81SJvhJZLN+0tvllNwGTfnX/Jr0dlgCi86xjfLMcBvsdda78nvyW9I/itdwBwMJ/Lk4T/+f8nh2eaLNUMUnQChiETh/GEUnRV0ebav7T6Ap8P7Gl6SPHcAbdvDpW6bzixdlLXE9cjWMrZtWSYmgUePc3n+C6KL35Cw85v4cFv1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"collect-homework-http-cache.png\"\n        title=\"collect-homework-http-cache.png\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/75c9e3b4bc95a266447227a14548be1a/fcda8/collect-homework-http-cache.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/75c9e3b4bc95a266447227a14548be1a/12f09/collect-homework-http-cache.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/75c9e3b4bc95a266447227a14548be1a/e4a3f/collect-homework-http-cache.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/75c9e3b4bc95a266447227a14548be1a/fcda8/collect-homework-http-cache.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/75c9e3b4bc95a266447227a14548be1a/47ff6/collect-homework-http-cache.png 852w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>通过开启<code>gzip</code>这类压缩算法，可以优先降低实际传输的资源的大小</p>\n<p>HTTP2 提供了多路复用的功能，可以提高多个并发连接时的性能。</p>\n<h2>webpack 打包优化</h2>\n<h3>使用代码分割</h3>\n<p>这个是 webapck4 中新增的功能，我们可以将多个 chunk 中的共同的部分提取出来，减少重复的代码，从总体上减少传输量。同时对于 vendor_chunk 我们也可以对其进行拆分，将不怎么变动的依赖像 react、redux、antd 之类的，单独放在一个 js 文件中，以达到更好的利用 HTTP 缓存的目的。最初将多个 js 文件合并打包到一个文件里是为了减少 HTTP 连接数，但是现在 HTTP2 多个请求可同时在一个连接上并行执行，或许将这类的依赖拆分出来可以提升缓存效果。</p>\n<h3>使用懒加载</h3>\n<p>懒加载是 webpack 提供的一项能力，可以配合 React16 中的 Suspense 和 lazy 使用。从我的这个项目场景分析看，大部分的用户都是只访问主页的，只有少数用户会访问其他页面，因此这里有必要将其他页面代码分离出来，当需要进入其他页面时再进行加载。</p>\n<pre><code class=\"language-jsx\">const loadingElement = &#x3C;Loading />;\n\nconst AuthPage = loadable({\n  loader: () =>\n    import(\n      /*webpackChunkName: 'auth_page' */\n      \"@/containers/AuthPage/AuthPage\"\n    ),\n  loading: loadingElement,\n  minDuration: 500,\n});\nconst HelpPage = loadable({\n  loader: () =>\n    import(\n      /*webpackChunkName: 'help_page' */\n      \"@/containers/HelpPage/HelpPage\"\n    ),\n  loading: loadingElement,\n  minDuration: 500,\n});\nconst AdminPage = loadable({\n  loader: () =>\n    import(\n      /*webpackChunkName: 'admin_page' */\n      \"@/containers/AdminPage/AdminPage\"\n    ),\n  loading: loadingElement,\n  minDuration: 500,\n});\n\nfunction App() {\n  return (\n    &#x3C;AppWrapper>\n      &#x3C;Router>\n        &#x3C;Route path={[\"/\", \"/detail/:id\"]}>\n          &#x3C;ListPage />\n        &#x3C;/Route>\n        &#x3C;Route path={[\"/auth\", \"/auth/registry\"]}>\n          &#x3C;AuthPage />\n        &#x3C;/Route>\n        &#x3C;Route path={[\"/admin\", \"/admin/create\"]}>\n          &#x3C;AdminPage />\n        &#x3C;/Route>\n        &#x3C;Route path={[\"/help\"]}>\n          &#x3C;HelpPage />\n        &#x3C;/Route>\n      &#x3C;/Router>\n      &#x3C;GlobalStyle />\n    &#x3C;/AppWrapper>\n  );\n}\n</code></pre>\n<h3>分析打包结果</h3>\n<p>使用 webpack-bundle-analyzer 分析体积较大的 vendor，一些依赖可能体积很大，但是只需要使用少数的 api，就可以考虑自己实现一下相关的函数</p>\n<h2>加载效果优化</h2>\n<p>SPA 应用令人诟病的一点就是页面的加载白屏时间长，浏览器加载 html 文件后，还需要加载相关的 css、js 文件，我们可以在 React 在页面 mount 的标签中放上 loading，当相关文件加载完后，loading 会被自动替换。</p>","id":"2db4d3dc-04cf-5208-8884-f472d61abd2c","headings":[{"value":"前言","depth":2},{"value":"服务端的配置优化","depth":2},{"value":"webpack 打包优化","depth":2},{"value":"使用代码分割","depth":3},{"value":"使用懒加载","depth":3},{"value":"分析打包结果","depth":3},{"value":"加载效果优化","depth":2}],"date":"Saturday, October 10, 2020 4:50 PM","tags":["随笔"],"title":"web应用加载优化相关"}},"staticQueryHashes":["63159454"]}