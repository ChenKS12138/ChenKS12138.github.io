{"componentChunkName":"component---src-pages-detail-tsx","path":"/detail/2db1a534-ecdc-5f4b-ad8c-915c64be2aca","result":{"pageContext":{"html":"<h2>概述</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 407px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/575dfbb19bb19ec74844c5dbbfe0717f/5bf10/stack-frame.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 110.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMEAQIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB71WxoTAxGEgP/8QAGBAAAgMAAAAAAAAAAAAAAAAAABECEiD/2gAIAQEAAQUCIu2UI//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABcQAQADAAAAAAAAAAAAAAAAAAEAECD/2gAIAQEABj8ChTr/xAAcEAACAgIDAAAAAAAAAAAAAAABEQBBITEQYZH/2gAIAQEAAT8hbBUAWMDvghCL1cAVx7gymFn2f//aAAwDAQACAAMAAAAQ8wAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHBAAAwEBAAMBAAAAAAAAAAAAAREhADFRYXGR/9oACAEBAAE/EF8BMfBcTZcwapBPoYCFZdHMHMQiB2ZBEj9xdFzGA8AcTeAhP1b/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"stack-frames\"\n        title=\"stack-frames\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/575dfbb19bb19ec74844c5dbbfe0717f/5bf10/stack-frame.jpg\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/575dfbb19bb19ec74844c5dbbfe0717f/a80bd/stack-frame.jpg 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/575dfbb19bb19ec74844c5dbbfe0717f/1c91a/stack-frame.jpg 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/575dfbb19bb19ec74844c5dbbfe0717f/5bf10/stack-frame.jpg 407w\"\n        sizes=\"(max-width: 407px) 100vw, 407px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>软件漏洞分析课程的一次作业，利用了栈内存的缓冲区溢出，覆盖了返回地址，从而达到劫持控制流的目的。</p>\n<h2>EXP1</h2>\n<deckgo-highlight-code language=\"c\"  >\n          <code slot=\"code\">#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nvoid function2()\n{\n  printf(&quot;Executed chagned\\n&quot;);\n}\n\nvoid function1()\n{\n  char buffer[5];\n  strcpy(buffer,str);\n}\n\nvoid main(int argc, char *argv[])\n{\n  function1(argv[1]);\n  printf(&quot;Executed normally\\n&quot;);\n}</code>\n        </deckgo-highlight-code>\n<p>使用<code>gdb</code>进行调试，<code>strcpy</code>函数可以被利用引起缓冲区溢出，目前的问题时需要多长的字符串，以及需要将<code>function1</code>栈帧的返回地址覆盖为什么</p>\n<p>环境</p>\n<blockquote>\n<p>ubuntu 16.04</p>\n<p>gcc 5.4.0</p>\n<p>gdb 7.11.1</p>\n</blockquote>\n<p>关闭堆栈保护机制，使用<code>gcc</code>编译</p>\n<deckgo-highlight-code language=\"bash\"  >\n          <code slot=\"code\">gcc -g main.c -m32 -o main32 -z execstack -fno-stack-protector</code>\n        </deckgo-highlight-code>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/13c598c708f4eb9474486696b2aa89af/a2ef2/gdb-debug.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB70lEQVQ4y41UWZaCQAzkCrOoKPsiO4jgOvoxc/9DZVLxxYfOoH7k0aQ71ZVK0oYTpPRpuvQxc2jhxpTkK0qKFUVpTXM7lL3J3BMbrsfMACAWCDatgGb/2BDsGaihDC1mFyYlpUVLWbWmvO4oZpbwzZ3oD9gYsBEsCwmYLnxhY/sJWV4sX0gA032AqCnoPbBRt1th5IYpgS0Y4QtAN8wEEP8LN5ILTZZGwUcYlgSWHgcDxAkYiAG8KBe73YM/E8Zj6Rt+XMhhHAJAlFbyjbNaAMDItC+FeZtYYprq+9SW7himb6RlK20CJn6cS8owpAVAFMbylvKPNQxr+HC5FvXKMK86avuDaIhD/f5MzXovQdD2cPq+9CRn0G6O1O1OsgcSx/OPXKAsBbBoeoLFEhRKcJhUsqkF0UJACp9N+pYvQNHu9TSyck3LvJH+QwAOoVAAUY1gOk3vU+eql/pvNERaGLei7iVFaIpKAhwSoF1Uw7HpuK0yB/asC/SByADQApUshfgGjf10lnF7t/2iarWhgFtItUIrYfzAHD6k/2hCroC2v6Q1s6vbnWh36cdMxIdv1e0JvQrG5t3r85Bh2WwoZEBUFmA6fsMqv/TaoP+67Ykqnuk4a2TsMH4A0yq/8ihcAdGgG25m6Ad2kOBRwDOGv6cg6vL/Yl+bAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gdb\"\n        title=\"gdb\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/13c598c708f4eb9474486696b2aa89af/fcda8/gdb-debug.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/13c598c708f4eb9474486696b2aa89af/12f09/gdb-debug.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/13c598c708f4eb9474486696b2aa89af/e4a3f/gdb-debug.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/13c598c708f4eb9474486696b2aa89af/fcda8/gdb-debug.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/13c598c708f4eb9474486696b2aa89af/efc66/gdb-debug.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/13c598c708f4eb9474486696b2aa89af/c83ae/gdb-debug.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/13c598c708f4eb9474486696b2aa89af/a2ef2/gdb-debug.png 1970w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>可以得出<code>ebp</code>与<code>&#x26;buffer</code>相距 13 个字节，同时返回地址占用 4 个字节，<code>function2</code>的地址为<code>0x0804845B</code>，构造出 payload<code>AAAAAAAAAAAAAAAAA\\x5B\\x84\\x04\\x08</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5527543722b3b53147f9eb49eb763609/691b3/stack-overlow-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.81081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAbElEQVQI102MWw6DIBQFXUNrH1qFwlXoA4S4/71NgbRJPyYzOR+nk7ghOWFTwW9oG9ASmM2L6V5ZS7tix00vjEpaj2ppVvbxxXMaNJ3EhJQzEyLGRazLrM+9nVb8O3M4TxwvM/1VNX5d/U/dPqdHN1fNwTfWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"stack-overflow-result\"\n        title=\"stack-overflow-result\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5527543722b3b53147f9eb49eb763609/fcda8/stack-overlow-result.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5527543722b3b53147f9eb49eb763609/12f09/stack-overlow-result.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5527543722b3b53147f9eb49eb763609/e4a3f/stack-overlow-result.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5527543722b3b53147f9eb49eb763609/fcda8/stack-overlow-result.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5527543722b3b53147f9eb49eb763609/efc66/stack-overlow-result.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5527543722b3b53147f9eb49eb763609/c83ae/stack-overlow-result.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5527543722b3b53147f9eb49eb763609/691b3/stack-overlow-result.png 2156w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>成功调用了<code>function2</code>，同理地址也可以被改成其他的函数地址。</p>","id":"2db1a534-ecdc-5f4b-ad8c-915c64be2aca","headings":[{"value":"概述","depth":2},{"value":"EXP1","depth":2}],"date":"Wednesday, September 16, 2020 3:59 PM","tags":["随笔"],"title":"栈溢出利用"}},"staticQueryHashes":["63159454"]}