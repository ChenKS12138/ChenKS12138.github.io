{"componentChunkName":"component---src-pages-detail-tsx","path":"/detail/0c3a55e2-35a4-56c9-965e-d4ba4983c0d2","result":{"pageContext":{"html":"<h1>前言</h1>\n<p>今年经历了一次软件供应链攻击，为此觉得有必要想详细复盘，并了解一些相关的攻击手段和可能的防范措施。NPM 有着丰富的生态，但是其中依赖包质量参差不齐，容易成为黑客进行渗透的手段。</p>\n<h1>经历复盘</h1>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/f0a0069718d38a74b71d6294ab8cb359/96658/1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 22.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAu0lEQVQY022MQW7CQBAEeUbsmenZAAeQiO0YYyMEBgGH/P9DHe1miQziUKpe7ahmq+WSbV3xu/ritqkTCwfnplzAnphPiG/AaIZkABQRzgb94KAley3YacFBC/YQVm+oIWzy7pKV5WvwAuE9OK8BiZ9oN14yZzfeA3gLfz66cReBpqC8BoMKe4+H4MnBg4P7vMfsxx7zf7zfwLgCUshsEixV2bizd2frzi7v3cRt9hrgZwqAYkY1+489gr924I0rc/ZehAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"构建环境\" title=\"构建环境\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/f0a0069718d38a74b71d6294ab8cb359/fcda8/1.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/f0a0069718d38a74b71d6294ab8cb359/12f09/1.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/f0a0069718d38a74b71d6294ab8cb359/e4a3f/1.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/f0a0069718d38a74b71d6294ab8cb359/fcda8/1.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/f0a0069718d38a74b71d6294ab8cb359/96658/1.png 881w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图1-构建环境</div>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1a07745f6a187629f7fc5d8b9f3dad3f/4e6ec/2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABcSAAAXEgFnn9JSAAABvklEQVQoz3WO6YrbQBCE9f7PFcivJAR2ba+9XmttHTOS5tLcY6kryNksJJCGj+qjaKrqVNI3PqGtb3TlgjqhqZczdcJQO2pqBvWYhU2kQiHp80N1vH9QHvy5VRdZNLcZx07SoZW4yoDWJDBbYBZAZYIugL5vPaAzYfQLLoNDPXn0JqPVCSoR3AJUWU6aUkTbcGpujLqGkxwERTPTYjQhJ0LZyJSjoylMNHlN+9uNTn1Ll6EnZgRNQdIUBVVOaX1PCW91T/U7Q9OO0GrGtivOYS0ZaymgUpBThIozpLfY1S3OHcd1nGCihy0eKs2o0rJqAsCUI+USTCj4X22+dVkRY0E/aEjtEEL+y1O55qYD68HONbHzO6b6isAZ0sCROP+tA0dkDFkKhJjgN0KCCwkpF+Ry/6RyX7/o6fs3tD9+knh6gtk9wx72iKcXhNMB/mUP97LHvHtGOO4xzw7249m/WB9RZa10URK8bmi8tgjj+EiShECWEvD2E3IzSimYXUTTCwyTgfcRIWY4n1C2hPshaxZWHAdLB25xkRGvo8eRW1x1wpgIPK4Y4goeVjBX0JiEQ2fwOljUIuDE7YPeFvwC3kmta/YwzQIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"依赖别名\" title=\"依赖别名\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1a07745f6a187629f7fc5d8b9f3dad3f/fcda8/2.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1a07745f6a187629f7fc5d8b9f3dad3f/12f09/2.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1a07745f6a187629f7fc5d8b9f3dad3f/e4a3f/2.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1a07745f6a187629f7fc5d8b9f3dad3f/fcda8/2.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/1a07745f6a187629f7fc5d8b9f3dad3f/4e6ec/2.png 827w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图2-依赖别名</div>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/afd4be73bb86963ae4173874a00d9f3d/65c7b/3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABcSAAAXEgFnn9JSAAACEklEQVQoz4WSW2/UMBCF98eCEL1sy7YV8MQD/44HhFqkUkraZJPNxYlzceK744PiVt32oTDSpzMzlo9H1qzWJxt+fvHJnp1/NAeHa3N4tDYnpxuzObswHzbn5uj4xLw/ODIHC4fH4Xxh6b15+y5wvD41n798NaebC7MCYJ1zEIJjhoOHD+pgH+sZ/wqtNYwxqGsCay1WQgitlAIhxNOGeqGFn9TkuZr8JMfAkkst/TzP3jn3gqW3ACDoSkpplpeUUn673YK0NchIQDlFJzu0ogUVFIMawI3ADB8m86/wZCiE8GkcoyYFOlZDCAYlJ0g5QkoGIYaQGyUwGw1Y+wJvDeDcg2FwV8pXN1e4u/6OKrnGLrlCFl8i+vMNafwD+fYn6uwGWXIZdIFkvwI0v0VX3kNmd88MOfdtkyKdSsR9gnhIkQwZoi7GfZ8gn0qUvAZVPTrNwCwPOlqBXjNQO2JqdnvDeTHMb7Elt8irCGn5GwW5Q1nfIycRtuVN6DU0Rd+XmFgDzijE2GIWHE5JOFLs/1BL6ek2Aa9y2J5CtRVkW0HQArItoVoCN7SYhxaubx/zLtSe9QDr4dmwNzTG+J4xjFJgtBzSaQinwK18UKfCZv4vngyllH6X7UBZjXzYoR4JyiEPVKxAs6zS1EBoDngP/wr7PdTKR1GEoiww8AEtp5BGQlkVVFsdsM6Gi2EXH/X5hH8BsdF9VZ+bMA8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"恶意脚本\" title=\"恶意脚本\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/afd4be73bb86963ae4173874a00d9f3d/fcda8/3.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/afd4be73bb86963ae4173874a00d9f3d/12f09/3.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/afd4be73bb86963ae4173874a00d9f3d/e4a3f/3.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/afd4be73bb86963ae4173874a00d9f3d/fcda8/3.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/afd4be73bb86963ae4173874a00d9f3d/65c7b/3.png 795w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图3-恶意脚本</div>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/95e2df883e39438e61ce0d206164edfa/d7542/4.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcSAAAXEgFnn9JSAAABgUlEQVQoz5WRW0/kMAyF+///3WqfmA5Dh5YpLb3k0jaJ4/isUtQR8ACspSNHsfP5WCnq5sbVteHqueHLU8WnsuT65YUpRhYRBvBfKuLWwqkzaL1C2MArA7IWQRtwjIguYlMbwhKQKCElwWoJiyFQSOAkMC5gDYSYBMXYneX1+Y909V9p61JeL0/SPJxkvt0kd8c1yjZu4pUXdixMkHlwMvWbBCdCCTI7Eu2jeBYp6vqG6trsOpVnXKoK5eMj2q5DCAHeewQK8BQQY0SOlBhEHjHSXqfckzMFFNYaaK2gtYZSClopqHne8/D2hmEY0Hc9+r6HVnoHMjPWdYW19n3gMdgTigyZxhF+msBKIc4zYs5KgY15Vz4rhaA1Ukpwm4M1y+7YLQmrTlgVYEegmLMbrfepOUTkW+XIbqZpwrZt+9kYc39b5EK+/A3sADrnMI4jiGjXsiz3epFXOGA/xUeHh6v8PusO/Nj4W4cZ2Lbtp1XvwK+w79wd9fwZ+Yfzul+B/wCaeVjl9mV95QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"官方标记\" title=\"官方标记\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/95e2df883e39438e61ce0d206164edfa/fcda8/4.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/95e2df883e39438e61ce0d206164edfa/12f09/4.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/95e2df883e39438e61ce0d206164edfa/e4a3f/4.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/95e2df883e39438e61ce0d206164edfa/fcda8/4.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/95e2df883e39438e61ce0d206164edfa/d7542/4.png 810w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图4-官方标记</div>\n</center>\n<p>由于构建流水线的的 NPM 版本过低，不支持<code>Dependency Alias</code>(NPM 6.9 及以上支持)。导致出现缺 NPM 包的现象，手动安装时，误安装了<code>fork-ts-checker-webpack-plugin-v5</code>，导致恶意的脚本被执行，造成本机的信息被泄露。</p>\n<p><code>fork-ts-checker-webpack-plugin-v5</code>是一个恶意包的名字，项目中 vue-cli 依赖的<code>fork-checker-webpack-plugin-v5</code>是<code>fork-checker-webpack-plugin</code>的一个别名。</p>\n<p>恶意脚本通过在<code>preinstall</code>这一生命周期钩子进行 burp 扫描，收集了本机的环境变量和主机名。同时这是一个跨平台的脚本，windows 和*nix 用户都会受到影响。</p>\n<p>在后续的分析中，发现这个 NPM 包在此前已经被官方 registry 标记为恶意包了，但是通过 tencent 源还可以继续下载恶意包，这也是造成此次问题的一个原因。</p>\n<h1>典型案例分析</h1>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2ccc8bb58ddf271c72ce50bc7f135203/84f4d/5.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACbElEQVQoz1WQ30tTARxHP/emOBWXtqXbdO6Hm815SXfvpk1DJ/kjdflirrVATUo3t9m2u7nN1mypiGEopVISIkVKhBSIFBToQ730FP0DvfRS0KsR0b4RQdCB83oeDigUYiiZZEgUGRKjDMVjLO2eR6S9FZzFAqsgoJ7n0XGqATmmaiz0tbHP3F0sURT3z3VjurcFsZ5m/IPCYVA6DRJFkBgFTSVAj1xsqL2lmLNYdFZBUFmtvNJh54tee5za651tjUvODu6es0u72t2bRwRkhk1McsjIvJpXABSJ1FAqZSZRNGf/GE9w5Pdqm+z1ORZekDZY+cKSSrsEOJvzfsCTt3yhSbbuaS5edZ+Wr7mbpeIAh4mLRvgGTPgbDAYPKZ3+SbHYj+zk5CElkpS97Jr+3NkNyErR03YS9EYiWQlrVB8fHlU+SSvLN5LlqruRCvXOjKJybkyviQ8ay8OXqnUv5xU5IK+3hcbHHeT3O7IBf2vWGzhDc+21uIYjDXWNRTYrn/9lW1ri7qkt3JtVFT1OqhULPr12Law9TvsS6Xqs0nB7XGdY9Ot0nzaLGWS9XmQDAWSDQVAwBBJHQQQm7DKXcHWCThB45ddtqTJztUq5c1Ml251V6qaGDfbUiIEb7TcpkOcA0Acgg7kxPUA+H0sTEywFAiwFJliKeNk/o0WXGfoaG1zdHL49lcpXwhrNu+XSio242hwfNNpujBhsmStVtsSQsby/i8ulvQKMu0z4j1+7BaDvAH1g4HedQL1FYNTGRhzcKWM8ztrc/cWyvLdLpbIXMyr581sq+cFi2bHNhLpsK1WR/yBaia1UBX4D4IzUiIdaDakAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"恶意代码进入依赖树\" title=\"恶意代码进入依赖树\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2ccc8bb58ddf271c72ce50bc7f135203/fcda8/5.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2ccc8bb58ddf271c72ce50bc7f135203/12f09/5.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2ccc8bb58ddf271c72ce50bc7f135203/e4a3f/5.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2ccc8bb58ddf271c72ce50bc7f135203/fcda8/5.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2ccc8bb58ddf271c72ce50bc7f135203/efc66/5.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2ccc8bb58ddf271c72ce50bc7f135203/c83ae/5.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2ccc8bb58ddf271c72ce50bc7f135203/84f4d/5.png 1208w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图5-恶意代码进入依赖树</div>\n</center>\n<p>这里整理的是恶意代码进入项目依赖树的几种方式，从依赖包的源代码编写，到构建发布，到镜像仓库托管，到用户下载，这整个链路都可能发生黑客攻击。</p>\n<h2>依赖混淆攻击</h2>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a42528ce56b3a263b6d3cdcd913fe69e/5f6dd/6.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.621621621621614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVQoz3WSy2sTURTG508U3LkRFIoLoTtRCIFu7KItLlzFpi59pCKIKGihFYk2Wk0fSZtImCZa8uhknEwmyeROZu79ycxkBmn1wOFyz/nOOd/57tUAlFJctCT2rV8jV3/D6l6B1U9PWTnYZLtTTkD4SPqugz2wEcJDk/PCiTfFmjgM3FHkgZSEmZ3GV+5t5bjxfJmFJ8tc37zPK72YDvZmgoNKmepxHeF5aEliJFyM0SDynmMxk0EU/9w9YvH1A67m7nItn+HK+h0Kte0oF5EJAoRhYNlDlJRoYYOQ3f+s55qcWE2q5inHZpOKqXM2NlJZLoqlvdjfodrRo0sggxiUeAKf+nBugmHFftZB9vupjn/XaOeOhTsTlyYmZ9c1KZsNSr06pfYJu0aN5qg7x8T4pFnEMH1VIVCOg7Jt1HCICmINi+1D1vYLZD9skN1aJ1Pc4O2v0pyAvPRDtJTuZII0jGgVZVnIwA814H3rO3srWdqLt/m5lKF16yZHpXcEYoo8bSJbrRiv6yjfjxn+8x+GyyjY/V3ny8s8jccP+fEsT+3RGoeVj7EkMmYYbqPG40jDP1ZnnYQvGFJ7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"依赖混淆攻击\" title=\"依赖混淆攻击\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a42528ce56b3a263b6d3cdcd913fe69e/fcda8/6.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a42528ce56b3a263b6d3cdcd913fe69e/12f09/6.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a42528ce56b3a263b6d3cdcd913fe69e/e4a3f/6.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a42528ce56b3a263b6d3cdcd913fe69e/fcda8/6.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a42528ce56b3a263b6d3cdcd913fe69e/efc66/6.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a42528ce56b3a263b6d3cdcd913fe69e/5f6dd/6.png 1139w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图6-依赖混淆攻击</div>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/494715535c0eb5db60405513b428902e/6e6fb/7.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcSAAAXEgFnn9JSAAACM0lEQVQoz4WRS08TURiGu5NImPuZW6fTGaYDDC0XW0pTW0QNNFxkMNSdazfGVBMDrKwmrkxcSTDxggoSsEZSUYiokfCDHH/CeU1PYVUTF0++nG/x5P3eE2scnPx5svb69+3lelRbfhTdXalHtdV6VFv5P/dWH7L5+Ol6tPPlOGocnkSx3cMT3KjeRNnmkJuUISQIJFGGpCiQFAKZqP+AMBRVQ3dPD0qXp7C1d4Sd/V+Ibe4dYS6sUl3XqRP41HA9qtsuwzDjlGgaVVSVEk3vQDVMygkiLU5coS+2m/R98weNbXz4ium5kIqWA79wFan8JJzhMVh+AKc/jYQfwHA8EFVjiRRVbU+ish3H8yiULmH9bYOljL3a2cfU7ALt4XikCpNwx8pwLhTh5UpwsyUk06OwB4aQzOTgjIzD8vqhGia0hAPTTUEkGvLFMtY2drH5iQk/MyEvShjsDZCxPAy6A0i00g2OwG1JUgGMpId4KoDp+kyo2w7MXh+SqmO8WMazDiEvIE/iyPEKihxBnleQtGyYXh+rwB0twLBsyLLScXL+4sRpwm/tkyvXrlNRVjBkJJFWDATExLBiYISY6DMSsHp92MEwnEyWdavqBkMz4xAkmXXIhK0O3zQO2Kec7+6GKIgM/hSJFxitFJwggJdktKrhBJEhSBLOdXUhO17E83cfsbX3vS2sLT+gM+ESZsIqpucXUZlfZPOMytluLkSlxel7ZmEJs2EVt+7cx8vtJrabP/EXNX1cbMx1MPgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"疑似内部依赖包\" title=\"疑似内部依赖包\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/494715535c0eb5db60405513b428902e/fcda8/7.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/494715535c0eb5db60405513b428902e/12f09/7.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/494715535c0eb5db60405513b428902e/e4a3f/7.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/494715535c0eb5db60405513b428902e/fcda8/7.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/494715535c0eb5db60405513b428902e/6e6fb/7.png 618w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图7-疑似内部依赖包</div>\n</center>\n<p>今年的 2 月 10 日，国外的安全研究员 Alex Birsan，发现了一段疑似 Paypal 内部的 package.json 的代码，公有的依赖包和私有的依赖包混合在一个文件中，并且这些私有的依赖包在 NPM registry 中均被没有注册过，于是他在 NPM 官方的 registry 上投放了一些同名的恶意包用来收集信息。普通用户如果没有设置好源，或者是内部镜像源出现了回源，高版本依赖包优先级高于低版本依赖包，也会有出现被污染的情况。最后 Paypal、苹果、Tesla 等公司受到影响。</p>\n<h2>误植域名攻击</h2>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bba17daeabce608bc2ffdf66b4aab2ea/73fd0/8.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpElEQVQoz3WRy2sTcRSF5/9fjE60VrEakQhtfeBCUl1Y6FJcKCkWqX1oop0k837e32vmk0k2LuqFA3fxXc45XO/t5DGHe/d4/WSHg92A/Z2AyShg7PuM/RHP7+5x8u6Eo1cTDvdGvBnvcvAwYP9BwIv7I8b+HZ76Ac/8R7x/+QFPRPG/uby84OPx8WZXouj727ksS5lOp7TG4GV/rpEiRbWCMxajNEYbjLY0TUtelDhrKcM5Kluhqwqt9ZZTBmMsQ6gsLzDW4plyga0j0nBJtIqRStGZjrrUaNUhrse4juTmnOXPU8Kra/I4xjQG21pkUGPRXY+2HV5dCWlWEEVronVMluc0bYuxBhHBOUff9yRpzk24IlwuSeKYqiqp6xprLaJk02LgvLPZZ77MPnH6/YLzxYwfv74R/p7T1BVRHFOUOdYN9ZuNgVYKJ4IVwZitaRRF5EWO1grv7Oorq/kCYzvECkq3OGtQIhR5TZl0qLZHKbn1IUPCqqwpU4fUPV6W5MRJsqmRxAnZao00zcZdKY20mr7bHg+V/tUwA9e2Ql23ONfxF/3bVJjbXBFCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cross-env钓鱼包\" title=\"cross-env钓鱼包\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bba17daeabce608bc2ffdf66b4aab2ea/fcda8/8.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bba17daeabce608bc2ffdf66b4aab2ea/12f09/8.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bba17daeabce608bc2ffdf66b4aab2ea/e4a3f/8.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bba17daeabce608bc2ffdf66b4aab2ea/fcda8/8.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/bba17daeabce608bc2ffdf66b4aab2ea/73fd0/8.png 793w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图8-cross-env钓鱼包</div>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/fbb5c295235acdac6491de4eeca7c99b/b88bf/9.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABcSAAAXEgFnn9JSAAABO0lEQVQoz22RW47kMAhFs48uAwb8SioZ9ex/bdyRXalSSz0fVyg2OTqY7brO6GMPNw1TjZzzr6hqHMcz3EvUtkcbR/TRorcSxS3c7NO7MUu08xvnsaOqQJiQhaHCMJFVhRLcDKYK1gpvA605RvV1JsxIKa1sRBT1uND7iO4ae7GVqjmK5rAsIUzLwsxCrIW1PcreYz+fcZxHtFpDmCOlNA05+vUX+3GGZ4GroGhelvO7ma7q7ssye0N7/kFWB7EgZwZLBt2WmwiHlQrzGhPyVk9ESOmVr8cDNkee8HHivK71FJQSKNGqTAQiwjJ8QR5B9+HP8AKnBZyWaoa9ljWFF8OYb9k7itnq3ebc989Bb7sfoRsoc0FzAVmh5vDisFKQVV/j3n1rKR/gfwzfwDe8joE2BrIamPlzT/f9PyRR3mvxSqIXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cross-env钓鱼包\" title=\"cross-env钓鱼包\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/fbb5c295235acdac6491de4eeca7c99b/fcda8/9.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/fbb5c295235acdac6491de4eeca7c99b/12f09/9.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/fbb5c295235acdac6491de4eeca7c99b/e4a3f/9.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/fbb5c295235acdac6491de4eeca7c99b/fcda8/9.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/fbb5c295235acdac6491de4eeca7c99b/efc66/9.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/fbb5c295235acdac6491de4eeca7c99b/c83ae/9.png 1180w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/fbb5c295235acdac6491de4eeca7c99b/b88bf/9.png 1702w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图9-cross-env钓鱼包</div>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/694056908abe48a2516f6e9920fd2aa1/40040/10.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAABcSAAAXEgFnn9JSAAAB/UlEQVRIx6WV2Y6DMAxF+f//mxZIAmWnQBaWEOhI8cgZFU3fhvBgCQnp6PravgnGeRHdwDchR6PG2czaGLN/G212s267Wc25CvpBmFsYAU1SyIoS6rYDoUZYtxdos4M2L9Db/ysQatRplkOa5bbtejsIZZd1s+v2strsdj1ZqFCz9AFl3dhnz0FNyx91u/s+U8EgpP663yHLS9s8O5BqugbsudCEMkgema3bJ4yzhmXdDthZqPMQgeghDgWLS+UPRIURIU5h1bQwCHn89Gq5G7gOo9gBy7px6sz+fXh4WmHXcx1TBnlZWZw2Dsa33UPhPYogLyrbdoMbyrW14dK1TJPUFmUNz/4aNBiE0oQxICyxeH44GDnOh49eix0RChGhFsHoYc/Fx2BOA8OYuJZZ+quQy9EfyKVyU8a1wZDAa0Ggt4cIvIUhhHFsMbrarnfqvNcGgVFM4BaGNnlkTuG06GsKMW0IZfaR5RhjLmS9b5nL0QFjSt3pNW3nPLwAVDqMY+chtoweTsvqv4fvocSE2rysAFP7rzpvhZiHuINX/Dvy8OseQlHVtm6eruXLwJhSt9h5UbmzuxSw78TO8sIiDN9kbbZreUhYggttMf4/H3nfV48xp7Co6o87Pgv7BQ7CrY0L2KqBQagPhWcr0Oum5TjBNGv7vmGzv8BsfvUDOycBb54hrR0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"hacktask发布的恶意包\" title=\"hacktask发布的恶意包\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/694056908abe48a2516f6e9920fd2aa1/fcda8/10.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/694056908abe48a2516f6e9920fd2aa1/12f09/10.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/694056908abe48a2516f6e9920fd2aa1/e4a3f/10.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/694056908abe48a2516f6e9920fd2aa1/fcda8/10.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/694056908abe48a2516f6e9920fd2aa1/40040/10.png 616w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图10-hacktask发布的恶意包</div>\n</center>\n<p>这个翻译可能有点让人摸不着头脑，换句通俗的话讲就是钓鱼攻击。用户在下载依赖包时，包名出现了偏差，导致下载到恶意包。看起来的很低级的错误，但是还是有发生的可能性，不少人会犯。用户<code>hacktask</code>在 NPM 上发布了大量的恶意包，目前已经全部被标记为恶意包，用的 NPM 账号及注册邮箱已被封禁。这也说明了一件事，批量发布恶意包是成本很低的一件事，可以根据 NPM 包命名规则批量生成恶意包，或者是提前抢注官方可能但未使用的包名称。</p>\n<p>这些有的钓鱼包像<code>crossenv</code>在功能上甚至和官方包无差异，只是多增加一些旁路的恶意的逻辑会上报本机信息，这也是钓鱼包隐蔽的一个表现。</p>\n<h2>event-stream 事件</h2>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 475px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/17960cefbcdf83e54de819abd6fd049f/466da/11.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 114.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEWElEQVQ4y1VV+VOTZxD+/pse0047dtqx2ttWrXbUaqsUQeUQRCBCAJErcsl9QzjCKZfcRwhURalFTinKKQqK0xnG6XCFGIL2p6fz7JcvU3/Y2ffd3efNt7vPbpSLzVk4UhaJExUxOGa6ggtNmYjsLkZgSzbON6bBpyEV/jcyENpeAMZ616fA70Y6Apoy4duQimOmKJyoiBYsfUpoez5OVsXhdE0Cfqu+isDmbIR3FuFSWx50rbkIaMpCUEuO3MM6CsWva80DcXyUGGLdqgxyVxz/vob9zQ62nbLpeIU1+xbWt7ewarfKfWVrDS9t62KjrNmtErOxbXPh+AbfUvQdBXCrvgrP64nwuJ4g6fEr+FWXu4zylYzxbUxDSFu+pK7vKJQvpngILhHu1fGCUw4a9Xgn0Q0fXPPAhymeOGAMxaHiMPxUGgH3mnjRJyvj8HVeII6UXcbx8mj8UhGDo2WRUnviKO8mueOrvEAoYy/mMbA4iXuLD/HH4kPceTIh0v9kArcej8u5d27Edb698ECE/v6FB4JTsZMYfj4DZfDZFPrmR3Dz8ZhLfp8flQfU+zh6ZofQMzvs8ql67K0Y2vlBilu1QU2xJAKHS8IlFdaEqTPFU1UGSXl/USgY61mbKKVgzVmOA0Y9vi+8BJaOeCXOUo6LziaQeyw0C8+zRg9dW57c9WxIe4HYGENMcGuu+MjRiE4jFLbb6niFrR27CGmyKfdtl/7HtoGXW+vYdNhc1KHQb91RsXzD/sYBhSQ+W5cMr/oUeNVfk+mgPlubJFNyri4ZPg0pLqIHt+QIfYJbc2Sq6PNuULH0KT+booQSn2f7iz5UEi56d9Z5qePenAtSI07TUdMVsbGmx8ujcLgkAvuLQvBtfjB+KAqROip/Lj2CZU7tYN/8qFBE62Sf6HGYZ4fQOT0oPgo7bpkddt0ZxzcGnk5Cmfh7AaTO/WfTIvwBTe45tcY9sZF3S48EwzsxQ8+JnQI5rfxYHCYs55R8nHZOPpt0oOYkcCpOVcUJTUiXXytjJX2mSioRQ+z7yafxTX6Q2hQGnqlNkgb4N2VIsTnTpIJGDTaFZ03YPMawocRyDwS1ZEOxvd52tt+ODYdNtgi3zKpsFKtsFFJmxboq5zWnXYsjxuqkGimoZN5pRLS5DJHdJYjvrUTyzRqk99cj624jEvqqQOJz28T2mOQcbS5FfF+lxOQONEtMlLkUMT1lQnqF4/VR6hnsSvfCpxk+2J3lJ1T5MjdAbKSDX2O6TAa3ySfp3vgs0xd7sv3xRW6AYHaleYldasgNQkqQGt0z99E1PfiWkEJ3n/4l24QUoU2L63SezTMqrbh9lKmVJYwsz2J0eU6VF3MYc4pmJ78oo/+z8ezCLKvxtCn7CnXy+aQKU9pXoMPBYr1r86j0CJHUtQ1E/V2BTmykHaeLb7yX5A4l7Xad/MsZLOVSeBaXTaI29FaITfOxKQZLhWj6qSmxFpM0K6LLiP8A7bQy93kEqxwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"事件过程\" title=\"事件过程\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/17960cefbcdf83e54de819abd6fd049f/466da/11.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/17960cefbcdf83e54de819abd6fd049f/12f09/11.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/17960cefbcdf83e54de819abd6fd049f/e4a3f/11.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/17960cefbcdf83e54de819abd6fd049f/466da/11.png 475w\" sizes=\"(max-width: 475px) 100vw, 475px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图11-事件过程</div>\n</center>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5b8d3a47036600b2c155d1d1733798ea/98b29/12.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABcSAAAXEgFnn9JSAAABQUlEQVQoz42Q22rdMBBF/f+fk5c+lBQKKeQtL6U/0Di2j49kXUfSSJodrJOEtlDagcXaujCDNKn94h6/faGYctSHJR9oECiRj0S5VKqtD7g24vqLx97tLGWmEBNN+2VrD1/vYX3E87zgctWD/c3qsDAuwPoAH+Kw8zdb52GcH1lpM/IEgAHAmEPmeZZt22RdV1nXZXhZXmQ7Pb+I90FyzgMikhhp+Jaj1FrlbFjPhiUHSYmQyA8oOsR4ri1S9IjaoPWOf9XkjKk/vj+h1CaRMnKpg8INhSu4dbQuA67tr+TCSLlgWpe5fv50h8N6+fm8YNvVYFe3P7Qu4Bz0MYz/4G14iGn85ceTKQZxzuDQClpfodRpjeO4Qu07rD7wPzWJSO29g5mEC4E5o6SAnBNyzuASwERgShAA593e5XfkPXe8Alg6agECf/ReAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"原作者发言\" title=\"原作者发言\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5b8d3a47036600b2c155d1d1733798ea/fcda8/12.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5b8d3a47036600b2c155d1d1733798ea/12f09/12.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5b8d3a47036600b2c155d1d1733798ea/e4a3f/12.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5b8d3a47036600b2c155d1d1733798ea/fcda8/12.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5b8d3a47036600b2c155d1d1733798ea/efc66/12.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/5b8d3a47036600b2c155d1d1733798ea/98b29/12.png 937w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图12-原作者发言</div>\n</center>\n<p>原作者开发了<code>event-stream</code>包，作者个人维护这个包并没有什么获利，自己也不再使用，就直接将这个包的所有权交给了\"热心网友\"。但是这一举措被别有用心的人利用了，攻击者通过<code>社会工程手段</code><del>简单点说就是骗</del>，获取到了该 NPM 包的所有权，然后让<code>event-stream@3.3.6</code>依赖了含恶意代码的<code>flatmap-stream</code>，一段时间后又发布了<code>event-stream@4.0.0</code>移除了相关的恶意代码，按照 NPM 的语义化版本规范，大部分用户的版本应该都是<code>^3.x.x</code>，这就导致了不会轻易升级 major 版本，但是容易升级 minor 版本，许多用户会停留在 3.3.6 版本，同时审查最新的源代码时又审查不出问题。</p>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2a39619cd9a4b5022d9b07677f7bd707/30d16/13.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 94.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABcSAAAXEgFnn9JSAAADIUlEQVQ4y6WTXW8bRRSG/SO44S6t0pQktR3bNOQLrkrVq9Kq6YfrtEkKQgh+CvwCFNQLEFeoVVsqUK9AooIbFKGiQkpqu3bc1vXuzn7PzO7OeasZO7acShWIkZ59z86ZeaWZcya3fe+H7P7N7yjgieo86yrLcVW35yib+Sbu2Uy5fqhEkikuEyVkOoaei8WI3PNmUz1r1BHGHC96NhzmoWcz2Mwzse24YJ6PKBZmTRDFCEJNZIiFhEwzyCQ15AAoAOCck+t5Bsu2iTGXGGPkOGz47zgO2bZt5no9iyzLIiklASCAjOZIKUVKgQtJIOP9v0YOREpbJ45N9uN/4LWewGnUYT3eRfy0A8EFuEwhZAIhU3CZjCFMbkSOBoay06bd7W08efgQ9QcP0Pp7B2Gjjkjfn0gRcfmvMHeoT59JSRQGyAIfKgyhwgBpFCHNMqRp1tdXUMgOMDCk/uc/jsE+o/v0j0yk24H2dh+h3WzCdhiY64ExhlarhXa7jW63C9f14AcBPN83+SRJhsajogzaRsqERBSBxzGSNEWapmZDFIWIogiCc73GzGmklFBKjQwH5PbqDdXc2dGVpM7zF8OmthwPjuvD9UMwLzDxwapykSAeoGOdzzX+/Es9+v0PxDKhvc5TWLYD5vp9PB+eH8L1AqNiaNjX/dehGbbN/pGjmFMs5WuLoA6Q6e5An/1bzGW61gB++elnulZbx2cffYJPr32MD9c2sFG9is3L69i8fPUVNqpXDJu1dVw8s4of79wdN7y79SVVDh3BSr6EpZkCVo7NGV2aLhhdnM5j4egslqbzWNb52aKZW54tojwxiW+++Hzc8N6NG/R+pYSTC4s4Mb+A98rzWCnN493yiOXScSwWx1kuv4Pi5Ay+3fpq3PDm7TuUL8yicvxtlCsVFOZKmM7P4a38HKZmipg8WsDhqTwmJvOYOKL1mOHwVAFvvHkIW9e/7huqQTPd//U3On+lhgu1NVxYW8O5SzWsVmsm1jrkUg3nqzWcXa3i9JmLOHuuipOnPsCtW9+PGls3ZpplxLlAHHMDH6iJuUa8Fv0Y9NN7CceHG+0rqhUvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"事件的披露\" title=\"事件的披露\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2a39619cd9a4b5022d9b07677f7bd707/fcda8/13.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2a39619cd9a4b5022d9b07677f7bd707/12f09/13.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2a39619cd9a4b5022d9b07677f7bd707/e4a3f/13.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2a39619cd9a4b5022d9b07677f7bd707/fcda8/13.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/2a39619cd9a4b5022d9b07677f7bd707/30d16/13.png 672w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图13-事件的披露</div>\n</center>\n<p><code>event-stream@3.3.6</code>在 2018.09.09 发布后，直到 2018.11.20 有开发者发现了<code>nodemon</code>的异常 warning 才被发现。使用 nodemon 运行一个空的 js 文件，却被提示使用了被废弃的加密模块的 API，事情才被披露。</p>\n<p>直到 2018.11.26，NPM 官方下架了<code>flag-stream</code>和<code>event-stream@3.3.6</code>。</p>\n<p>攻击者的目标是<code>copay</code>，目的是盗取用户的加密货币钱包私钥，只有当用户安装特定的依赖包时恶意代码才会生效，可见其隐蔽性之强。</p>\n<h1>可能的解决措施</h1>\n<p>从上面的例子看，攻击手段主要是利用了 NPM 的声明周期钩子，又或者是将恶意代码注入到依赖树中，我们是不是可以通过什么方式进行提前监测，又或者是实时拦截呢？</p>\n<h2>依赖包异常调用监测</h2>\n<center>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/319fbb8795bb1b98bf919d9dcddbe951/1d69c/14.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 96.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACk0lEQVQ4y5WU2XLaShRF9RcGDJJaPWsekMCA7fj/P2qluiEEnFuV3IddGuqcpd1nULJMknmZUVqTZRl5nsfrL4Xn38o4zpq2bcjucelTfFL5jKqscdLjspRcKJSp8I1GWcl2u2W9WWOtwTlP5XNKX2ELiykkyrZoa/G1JU0zku0up6sUl6XkcDqzvJ0Y9ke6tuM41ozTxDLNGG3IheB1m6G1ph9GfNVSdTVlM+C9w1hLEmyW3vDx9c6Pry/eP8+cPt85nBaWtw/eLl/M4x5ZyHjkppJY564lEOJWCnEvS5KlGYXUFMZjtMDoAl/6+LVCOZRSWO+vyVnGaVH0fUtRFAghECJHPNQ5+TgblsOMlDIWOhe/m5LHpmSkaRrBMSbLIkgrHaHRncgpChHfJ8bk11q0B+q2ZNhXuNIjcoG4uxAUUmKsi4neVUzDnqab6acjh30XcwM8CZ0JRVa6xjiNtprtdsdu96zg0jkXXVrrGbqRquroxgN92+F8idKKJJw71CFNd6S7NCY+ztWjrLUR6KynD8BmoJ8W+nGiH0ekugPFXxXiIlBJvK2Z6j1j03M8n6jaiiy7NeUX8HkjnvUEDEd2nnHax1mc5pF+GijiWOV/d/gMdLduW5yrqVqLLxXOW5TS1y5/39fv+/wIDvseHRpHU4/4ssPbsI41Wps4RkkI0LcZux7nNszOYYx5akpoWIBLqRBSxlGKA18IVqsVr6+vJIVS+KaNkDB3oVOPbjabDev1+kkhefXyclW4X63i+/AjScKKzYcjyzzT99094eWWEJ4D9F8UYpOmbblcLpwvF6qmZbdL/4D8F/TR8WNM4uqW8XhhvnxSdgOb1y2bB8C/OrwDfVUzzAvamFi771/8v/oJbmkYuo+R65YAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"实时监测\" title=\"实时监测\" src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/319fbb8795bb1b98bf919d9dcddbe951/fcda8/14.png\" srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/319fbb8795bb1b98bf919d9dcddbe951/12f09/14.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/319fbb8795bb1b98bf919d9dcddbe951/e4a3f/14.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/319fbb8795bb1b98bf919d9dcddbe951/fcda8/14.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/319fbb8795bb1b98bf919d9dcddbe951/1d69c/14.png 750w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <div>图14-实时监测</div>\n</center>\n<p>不管是什么样的 NPM 包，它依赖的一些能力如网络 I/O、文件 I/O、密码学能力（也可以纯 js 实现）等，都需要由<code>Internal Module</code>又或者是自行编写的<code>ffi</code>提供，可以通过对<code>Module.prototype.require</code>进行 hook，监听所有的<code>require</code>，如果这颗 require 树出现了不应该出现的依赖能力就需要人工进行排查。</p>\n<p>目前只是一个比较初步的思路，<code>JavaScript</code>是一门动态语言，导致了我想通过静态分析的方式得到 require 树是比较困难的。当然也是可以通过一些事前的约定让静态分析得以实现。</p>\n<h2>依赖包可信指标检查</h2>\n<center>\n  <img src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/f9652573df1014758baad66a1f46c457/15.gif\" alt=\"npq\">\n  <div>图15-npq</div>\n</center>\n<p><code>npq</code>提供一个不错的事前检查的思路，我们在安装依赖包前，先从<code>发布时长</code>、<code>下载量</code>、<code>README</code>、<code>NPM生命周期钩子</code>、<code>漏洞库中的相关信息</code>、<code>开源许可</code>等维度对下载的依赖包进行审查，如果出现问题就阻塞下载让用户自行确认。这种方式对于钓鱼包，以及通过<code>pre/afterinstall</code>进行攻击的恶意包已经能有比较好的拦截了。</p>\n<h1>总结</h1>\n<p>恶意攻击和安全防御一直是一种此消彼长的状态，在这件事情上并没有银弹。每次新功能的加入都会伴随着一定的风险，当然也不是说一成不变就保障安全，对于我们设计出的软件，我们永远要做好安全方面的事前设计，事中的及时响应，事后的及时复盘。在这些安全问题中，人才是最薄弱的一环，我们需要通过设计更好的规则或者是工具，降低犯错的概率。</p>\n<h1>资料参考</h1>\n<ul>\n<li>[1] <a href=\"https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610\">https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610</a></li>\n<li>[2] <a href=\"https://security.tencent.com/index.php/blog/msg/182\">https://security.tencent.com/index.php/blog/msg/182</a></li>\n<li>[3] <a href=\"https://snyk.io/blog/typosquatting-attacks/\">https://snyk.io/blog/typosquatting-attacks/</a></li>\n<li>[4] <a href=\"https://snyk.io/blog/a-post-mortem-of-the-malicious-event-stream-backdoor/\">https://snyk.io/blog/a-post-mortem-of-the-malicious-event-stream-backdoor/</a></li>\n<li>[5] <a href=\"https://github.com/remy/nodemon/issues/1442\">https://github.com/remy/nodemon/issues/1442</a></li>\n<li>[6] <a href=\"https://github.com/dominictarr/event-stream/issues/116\">https://github.com/dominictarr/event-stream/issues/116</a></li>\n</ul>","id":"0c3a55e2-35a4-56c9-965e-d4ba4983c0d2","headings":[{"value":"前言","depth":1},{"value":"经历复盘","depth":1},{"value":"典型案例分析","depth":1},{"value":"依赖混淆攻击","depth":2},{"value":"误植域名攻击","depth":2},{"value":"event-stream 事件","depth":2},{"value":"可能的解决措施","depth":1},{"value":"依赖包异常调用监测","depth":2},{"value":"依赖包可信指标检查","depth":2},{"value":"总结","depth":1},{"value":"资料参考","depth":1}],"date":"Tuesday, September 7, 2021 8:45 PM","tags":["随笔","NPM"],"title":"NPM上的软件供应链攻击"}},"staticQueryHashes":["63159454"]}