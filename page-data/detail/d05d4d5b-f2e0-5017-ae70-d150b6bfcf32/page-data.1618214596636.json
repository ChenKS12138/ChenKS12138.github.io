{"componentChunkName":"component---src-pages-detail-tsx","path":"/detail/d05d4d5b-f2e0-5017-ae70-d150b6bfcf32","result":{"pageContext":{"html":"<p>JavaScript 本身是没有类继承的，但是我们又可以使用 ES6 中的<code>class</code>关键字来写一个类，它的底层实现是原型链。原型链的介绍在<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain\">MDN--原型链</a>上的介绍已经很详细了，但我想分享一下我的理解，如果不正确的地方，欢迎指出。</p>\n<h1>什么是原型链</h1>\n<p>在 chrome 的 devtool 中，我们打印一个引用类型的变量时可以看到这个变量一般会有个<code>__proto__</code>属性。这个对应的就是这个变量的原型。每个引用类型的变量都会有其对应的原型，然后其对应的原型又有其对应的原型 <del>套娃警告 ⚠️</del> ，这样的一条链被称为原型链，最终<code>__proto__</code>会指向 null。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a2590a405d91c5c4e4c48a6bfb71e324/0a867/prototype-chain1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABVElEQVQoz4WRSZKDMAxFOUYPmzB4jGebYAzBWeT+Z+oP9LToqn5FqYRsSV9yE31OaTbWxFscy+SCl0JeT6RkQti2nV5fbu9vsK7vpVLqehVCPJ/PxqjgXDBWc8GFkoTSruv6L+B3w9AScn7wz9PL5bJtW2ONm7PeFmu0pJQySlGVc84Yg5VACHbA2SeIIX+rtQk+5jzFiP5OawNRcKy1Wmvv/TiOIQRj9rg5QBwRJE+lNPiPQY6JD6Q3htwSZ7Rv27br2pNTe/+L4RBf69bE4B+P+7outd5LySH6FMM8l22rpRQ0hxDYnDNUpJTO/hiwLGujlVrKbV1wFKcp5Mlh+jnHR53GFCASgmGxe0KwTUoO0H9eFizMesutJpwNWlFnmRRMXakzWB7k7SK/1Z6QQ/YDCxNC7TPsR6h3OsPudLhD/oQez1mRPBylCfmp+i/IxyLxzh8oqGSeTq5lOgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"__proto__\"\n        title=\"__proto__\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a2590a405d91c5c4e4c48a6bfb71e324/fcda8/prototype-chain1.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a2590a405d91c5c4e4c48a6bfb71e324/12f09/prototype-chain1.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a2590a405d91c5c4e4c48a6bfb71e324/e4a3f/prototype-chain1.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a2590a405d91c5c4e4c48a6bfb71e324/fcda8/prototype-chain1.png 590w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a2590a405d91c5c4e4c48a6bfb71e324/efc66/prototype-chain1.png 885w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/a2590a405d91c5c4e4c48a6bfb71e324/0a867/prototype-chain1.png 986w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>就以上图为例子，我们需要先了解两个事实。首先 js 中的数组也是一个对象，第二 js 的数组通过下表访问数组元素时，本质上是使用了方括号表示法的属性访问器来获取对象的属性。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7d814d7681233f2bb80c8790e424bfcb/b6272/prototype-chain2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.97297297297297%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAABUElEQVQoz6WS207DMAyGeROWQ3O0kyVt164aLUhFTNoNd7wB7/8IOAUEYwch+OW2uchn/7Z7I4QwxjjnEFFKqY5VLVIXdMM5JziEUNe1FJKuSlkJSUe55NJKW3lBBaaa3nuCp/sp5bTtHgI2KfYU89PL4+GVs1tZkp7AZFtrXQoqOaWpywNCu1jVFFrba5XfYToxzhrfJKydTYvrEqTPDq7DgnXY1WkDsOWcLdxF7Ezl2jUtbpLvwIIxYLRnbEVDYfRZrRYXF2Dq0mrX+37EsY+9d2sKAA/0eJ9zpqX84D9gSk9vBPRqHU2bbbO2EQHGcSLN87zf72mddLn6pgJba0PA3d1uiP55SIcepgZDpLFJLigtpzvkvLg7VtkzwQChqQetRAumQ+tMWdNpk2d/Eogxe5tpvExUFCc1zots80q7kDqlSp1qiV/qa9p/0L/gN4q5ip5NjfDOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"__proto__\"\n        title=\"__proto__\"\n        src=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7d814d7681233f2bb80c8790e424bfcb/b6272/prototype-chain2.png\"\n        srcset=\"https://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7d814d7681233f2bb80c8790e424bfcb/12f09/prototype-chain2.png 148w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7d814d7681233f2bb80c8790e424bfcb/e4a3f/prototype-chain2.png 295w,\nhttps://cdn.jsdelivr.net/gh/ChenKS12138/ChenKS12138.github.io/static/7d814d7681233f2bb80c8790e424bfcb/b6272/prototype-chain2.png 580w\"\n        sizes=\"(max-width: 580px) 100vw, 580px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>可能会疑惑我们常用的 js 的 push 方法，没有出现在这里。这其实是没有问题的，当我们调用<code>a.push()</code>的时候，首先会查看对象<code>a</code>上是否有<code>push</code>方法，没有则继续查看其<code>__proto__</code>上是否有<code>push</code>方法，以此类推，直到<code>__proto__</code>为 null 时，说明 a 上不存在<code>push</code>，因而报错，对于其他引用类型的变量也是同样的道理。我们使用构造函数 new 一个新的对象时，新对象的<code>__proto__</code> 指向的就是这个构造函数的<code>prototype</code>。这样，我们将一个构造函数的<code>prototype</code>的<code>__proto__</code>指向另一个构造函数的<code>prototype</code>，就可以用 js 的原型链实现类的继承。</p>\n<h1>js 中的令人迷惑的 this 指向</h1>\n<p>js 中的 this 指向和函数的调用方式有关，我们可以分为以下几种方式。</p>\n<ol>\n<li>当作为普通函数调用时，this 指向的就是全局对象，这里的全局对象具体是什么，需要看运行环境。</li>\n<li>如果函数是作为对象的方法时，<code>this</code>指向的就是这个对象。</li>\n<li>如果函数是作为构造函数的话，那么 this 会指向这个<code>new</code>产生的新对象。</li>\n<li>除此之外还可以通过<code>call</code>,<code>apply</code>,<code>bind</code>这些方法来修改 this 的指向。</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">func1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  func<span class=\"token operator\">:</span> func1<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> person <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">\"chen\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">func1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 函数作为普通函数调用</span>\nobj1<span class=\"token punctuation\">.</span><span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 函数作为对象的方法调用</span>\n<span class=\"token keyword\">const</span> obj2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">func1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 函数作为构造函数调用</span>\n<span class=\"token function\">func1</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 使用call来修改this指向</span>\nobj1<span class=\"token punctuation\">.</span><span class=\"token function\">func</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 使用apply来修改this指向</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>建议跟着敲一遍代码，有助于理解</strong></p>\n<p>说到了 this 指向问题，不得不提一下<code>箭头函数</code>。<code>箭头函数</code>不仅仅是使函数的写法更加简短，箭头函数的 this 指向也与其他普通函数不同。箭头函数的 this 指向不会因为它的调用方式不同而不同，它的 this 指向的是定义函数处的 this。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1>结语</h1>\n<p>理解原型链和 js 中的 this 指向问题以及箭头函数的一些特性可以帮助自己在写代码时，少踩挺多坑的。相关的有意思的问题还有挺多的，也有一些安全方面的问题，像原型链污染之类的。</p>","id":"d05d4d5b-f2e0-5017-ae70-d150b6bfcf32","headings":[{"value":"什么是原型链","depth":1},{"value":"js 中的令人迷惑的 this 指向","depth":1},{"value":"结语","depth":1}],"date":"Saturday, July 11, 2020 8:18 PM","tags":["javascript"],"title":"原型链和this指向问题"}},"staticQueryHashes":["63159454"]}