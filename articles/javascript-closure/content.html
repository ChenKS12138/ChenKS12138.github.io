<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript中的闭包</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EZRSNLSEWX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
    </script>
    <script type="module" crossorigin="" src="/assets/app.86c4b747.js"></script>
    <link rel="stylesheet" href="/assets/index.2ee67331.css">
  <link rel="modulepreload" crossorigin="" href="/assets/content.a8afd7c3.js"></head>

  <body>
    <div id="app" data-server-rendered="true"><div class="w-full items-center justify-center m-0 p-0"><!--[--><header class="w-full fixed z-99" style="--57bdf034:url(&quot;/bg1.png&quot;);" data-v-69cc4069=""><div class="header-navigation text--layout flex items-center justify-center" style="height:64px;background-color:transparent;" data-v-69cc4069=""><div class="flex justify-between items-center w-3xl <md:w-full" data-v-69cc4069=""><div data-v-69cc4069=""><a href="/" class="text--link" data-v-69cc4069="">ChenKS</a></div><div class="flex text-sm font-400 items-center" data-v-69cc4069=""><!--[--><a href="/" class="text--link" data-v-69cc4069="">Home</a><a href="/article-list" class="text--link" data-v-69cc4069="">Articles</a><a href="/about" class="text--link" data-v-69cc4069="">About</a><a href="/RSS" class="text--link" data-v-69cc4069="">RSS</a><!--]--><button class="cursor-pointer text-white bg-transparent py-0.75 px-2.5 text-sm" data-v-69cc4069=""><span class="inline-block align-middle dark:i-carbon-moon i-carbon-sun"></span><span class="pl-2">Light</span></button></div></div></div></header><div class="w-full header-cover-bg min-h-lg" style="--57bdf034:url(&quot;/bg1.png&quot;);" data-v-69cc4069=""></div><div class="content-container-wrapper dark:bg-dark" style="--57bdf034:url(&quot;/bg1.png&quot;);" data-v-69cc4069=""><div class="content-container" data-v-69cc4069=""><!--[--><div class="h-70 -mt-70 flex flex-col items-center text-white"><div class="font-bold text-3xl">JavaScript中的闭包</div><div class="text-lg mt-2">2019-07-22</div><div class="mt-2 italic">#JavaScript</div></div><!--[--><div class="markdown-body"><h1>一道题目</h1><p>这是 ScriptOJ 上的一道题目 =&gt; <a href="http://scriptoj.mangojuice.top/problems/102">传送门</a><code>记忆化斐波那契函数（Memoization）</code> 题目是这样的</p><blockquote><p><strong>斐波那契数列</strong>指的是类似于以下的数列：</p><p>1, 1, 2, 3, 5, 8, 13, … 也就是，第 n 个数由数列的前两个相加而来：<strong>f(n) = f(n - 1) + f(n -2)</strong> 请你完成 fibonacci 函数，接受 n 作为参数，可以获取数列中第 n 个数，例如：</p><p>fibonacci(3) // =&gt; 2</p><p>fibonacci(2) // =&gt; 1</p><p>fibonacci(3) // =&gt; 2</p><p>…</p><p>测试程序会从按顺序依次获取斐波那契数列中的数，请注意程序不要超时，也不要添加额外的全局变量。</p></blockquote><h1>常规做法</h1><p>一般来说，斐波那契数列，我们会选择使用递归函数来解决，正如题目中所给的那样 <code>f(n)=f(n-1)+f(n-2)</code> 我们只要当 n 小于 2 时返回 1 就可以了。 用 JavaScript 处理后就是这样</p><pre class="language-JavaScript"><code class="language-JavaScript">const fibonacci = n =&gt; n &gt; 2 ? fibonacci(n-1) + fibonacci(n-2) : 1;
for(let i = 1 ;i &lt; 7;i++) console.log(fibonacci(i))
/**
 * 运行结果：
 * 1
 * 1
 * 2
 * 3
 * 5
 * 8
 */
</code></pre><p>这样处理对程序员来说确实比较轻松，几乎不用写什么逻辑，但缺点也很明显，这样递归占用空间较大，效率较低，容易超时。</p><h1>使用 JavaScript 的闭包</h1><p>我们可以看出一个很明显的特点，题目所给的数据是从 1 依次递增的，因此如果我们可以将前两次的数据存储下来，无疑可以减少很多不必要的计算量。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> fibonacci <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">||</span> n <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> temp<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> temp<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    temp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>运行结果如下：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fibonacci</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
1
1
2
3
5
8
13
21
*/</span>
</code></pre><p>并且使用闭包后能通过测试了。甚至我们还可以继续压缩代码，变成只剩一行代码。<s>看起来真得很爽，强迫症</s></p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> fibonacci <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">temp</span> <span class="token operator">=&gt;</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span>
  n <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">||</span> n <span class="token operator">===</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>temp<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> temp<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>使用闭包后，变量<code>fibonacci</code>不仅是个函数，并且是另一个函数的返回值，<code>temp</code>是另一个函数中的局部变量，同时，<code>fibonacci</code>又依赖于变量<code>temp</code>，因此虽然<code>temp</code>已经超出它的作用域了，但是<code>temp</code>并没有被垃圾回收机制（garbage collection）回收。同时，对于每一处调用的<code>fibonacci</code>对应的都是同一个<code>temp</code>。这样就可以对每次的结果进行记录。</p></div><!--]--><div class="rounded bg-gray mt-10 p-1 text-white italic indent-md text-lg"> CC BY-SA 3.0协议 。转载请注明出处! </div><!--]--></div></div><!--]--></div></div>
    
  

</body></html>