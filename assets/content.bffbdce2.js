import{_ as p}from"./ArticleWrapper.5f379090.js";import{c,w as e,o as u,a as n,b as s,_ as l}from"./app.91692cd0.js";import"./dayjs.min.28e220c7.js";const k="/assets/2.1df95839.png",i="/assets/3.006803f8.png",r="/assets/4.361b0fc0.png",d=n("div",{class:"markdown-body"},[n("h1",{id:"%E5%89%8D%E8%A8%80",tabindex:"-1"},"\u524D\u8A00"),n("p",null,[s("\u6700\u8FD1\u770B\u4E86\u300Athe linux programming interface\u300B"),n("sup",null,[n("a",{href:"#1"},"[1]")]),s("\uFF0C\u603B\u4F53\u611F\u89C9\u8FD9\u662F\u672C\u597D\u4E66\uFF0C\u8865\u5145\u4E86\u4E00\u4E9B\u8BFE\u5185 OS \u6CA1\u6709\u544A\u8BC9\u6211\uFF0C\u4F46\u662F\u540C\u6837\u91CD\u8981\u7684\u4E1C\u897F\uFF0C\u6BD4\u8F83\u6E05\u6670\u5730\u4ECB\u7ECD\u4E86\u4E00\u4E9B\u6BD4\u8F83\u91CD\u8981\u7684\u6982\u5FF5\uFF0C\u5982"),n("code",null,"\u6587\u4EF6\u7A7A\u6D1E"),s("\u3001"),n("code",null,"\u4F5C\u4E1A\u63A7\u5236/\u8FDB\u7A0B\u7EC4"),s("\u3001"),n("code",null,"\u6807\u51C6\u4FE1\u53F7/\u5B9E\u65F6\u4FE1\u53F7"),s("\u3001"),n("code",null,"\u8FDB\u7A0B\u7684\u5185\u5B58\u6A21\u578B"),s("\u3001"),n("code",null,"\u50F5\u5C38\u8FDB\u7A0B"),s("\u3001"),n("code",null,"\u8FDB\u7A0B\u95F4\u901A\u4FE1"),s("\u3001"),n("code",null,"socket\u7F16\u7A0B"),s("\u3001"),n("code",null,"ruid/euid/suid"),s("\u3001"),n("code",null,"elf\u6587\u4EF6"),s("\u3001"),n("code",null,"IO\u6A21\u578B"),s("\u7B49\u3002\u4E66\u4E2D\u6700\u540E\u4E00\u7AE0\u4ECB\u7ECD\u4E86\u4F2A\u7EC8\u7AEF\u6280\u672F\uFF0C\u8FD9\u91CC\u6211\u60F3\u52A8\u624B\u5B9E\u73B0\u4E00\u4E2A\u57FA\u4E8E web \u7684 terminal\uFF0C\u987A\u4FBF\u590D\u4E60\u4E00\u4E0B\u4E4B\u524D\u5B66\u5230\u7684\u4E1C\u897F\u3002")]),n("h1",{id:"%E4%BB%80%E4%B9%88%E6%98%AF%E7%BB%88%E7%AB%AF",tabindex:"-1"},"\u4EC0\u4E48\u662F\u7EC8\u7AEF"),n("p",null,[s("\u5728\u5927\u578B\u673A\u7684\u65F6\u4EE3\uFF0C\u4EBA\u624B\u4E00\u53F0\u8BA1\u7B97\u673A\u7684\u4E8B\u60C5\u662F\u4E0D\u53EF\u60F3\u8C61\u7684\uFF0C\u76F8\u6BD4\u4E4B\u4E0B\u66F4\u4E3A\u5E38\u89C1\u7684\u662F\u7528\u6237\u901A\u8FC7\u4E00\u53F0\u7EC8\u7AEF\u8BBE\u5907\u63A5\u5165\u5927\u578B\u673A\u3002\u968F\u7740\u4E2A\u4EBA\u8BA1\u7B97\u673A\u7684\u666E\u53CA\uFF0C\u6211\u4EEC\u901A\u5E38\u4E0D\u518D\u9700\u8981\u5355\u72EC\u7684\u7EC8\u7AEF\u8BBE\u5907\u8FDE\u63A5\u6211\u4EEC\u7684\u8BA1\u7B97\u673A\uFF0C\u63D0\u5230\u7684\u7EC8\u7AEF\u66F4\u591A\u7684\u662F\u865A\u62DF\u7EC8\u7AEF\u3002\u4ECE\u865A\u62DF\u7EC8\u7AEF\u7684\u5B9E\u73B0\u4E0A\u53C8\u5206\u4E3A tty \u548C pty"),n("sup",null,[n("a",{href:"#2"},"[2]")]),s("\u3002tty/pty \u8FDE\u63A5\u4E86\u7528\u6237\u7A7A\u95F4\u7684\u8FDB\u7A0B\u548C\u5916\u90E8\u7684\u8F93\u5165\u8F93\u51FA\u8BBE\u5907\uFF0C\u4E0D\u540C\u4E4B\u5904\u5728\u4E8E tty \u8FDE\u63A5\u7684\u662F\u5185\u6838\u7684\u7EC8\u7AEF\u6A21\u62DF\u5668\uFF0C\u7EC8\u7AEF\u6A21\u62DF\u5668\u5916\u90E8\u5BF9\u5E94\u771F\u5B9E\u7684\u5916\u8BBE\uFF0Cpts \u901A\u8FC7 ptmx \u8FDE\u63A5\u5230\u5176\u4ED6\u7528\u6237\u7A7A\u95F4\u8FDB\u7A0B\u3002")]),n("h1",{id:"web-%E7%BB%88%E7%AB%AF%E7%9A%84%E5%AE%9E%E7%8E%B0",tabindex:"-1"},"web \u7EC8\u7AEF\u7684\u5B9E\u73B0"),n("h2",{id:"%E5%AE%9E%E7%8E%B0%E7%9B%AE%E6%A0%87%E5%8F%8A%E6%96%B9%E5%BC%8F",tabindex:"-1"},"\u5B9E\u73B0\u76EE\u6807\u53CA\u65B9\u5F0F"),n("p",null,[n("img",{src:l,alt:"aliyun-web-terminal"})]),n("p",null,[n("img",{src:k,alt:"addon"})]),n("p",null,"\u6211\u4EEC\u5728\u4F7F\u7528\u5404\u5BB6\u4E91\u670D\u52A1\u7684\u8BA1\u7B97\u65F6\uFF0C\u90FD\u4F1A\u63D0\u4F9B\u4E00\u4E2A web \u7684\u7EC8\u7AEF\uFF0C\u6211\u7684\u76EE\u6807\u5C31\u662F\u5B9E\u73B0\u4E00\u4E2A\u7C7B\u4F3C\u7684 web \u670D\u52A1\uFF0C\u901A\u8FC7 websocket \u8FDB\u884C\u901A\u4FE1\u3002\u540C\u65F6\u56E0\u4E3A Node.js \u7684 Built-in \u6A21\u5757\u4E0D\u63D0\u4F9B\u4F2A\u7EC8\u7AEF\u76F8\u5173\u7684 api\uFF0C\u6211\u7F16\u5199\u8C03\u7528\u76F8\u5173\u7CFB\u7EDF\u8C03\u7528\u7684 Node.js Addon\u3002"),n("h2",{id:"%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86",tabindex:"-1"},"\u5B9E\u73B0\u539F\u7406"),n("p",null,"\u4E3B\u8981\u7684\u6D41\u7A0B\u5982\u4E0B"),n("ol",null,[n("li",null,[s("\u8FDB\u7A0B\u8C03\u7528"),n("code",null,"posix_openpt"),s("\u83B7\u53D6\u4F2A\u7EC8\u7AEF\u4E3B\u8BBE\u5907 fd")]),n("li",null,[s("\u8FDB\u7A0B\u8C03\u7528"),n("code",null,"fork"),s("\u751F\u6210\u5B50\u8FDB\u7A0B\uFF0C\u7236\u8FDB\u7A0B\u8FD4\u56DE\u4E3B\u8BBE\u5907 fd")]),n("li",null,[s("\u5B50\u8FDB\u7A0B\u6253\u5F00\u4F2A\u7EC8\u7AEF\u4ECE\u8BBE\u5907 fd\uFF0C\u5E76\u5C06"),n("code",null,"stdin"),s(","),n("code",null,"stdout"),s(",'stderr`\u6539\u4E3A\u4F2A\u7EC8\u7AEF\u4ECE\u8BBE\u5907")]),n("li",null,"\u6267\u884C exec\uFF0C\u4E00\u822C\u662F shell \u7A0B\u5E8F")]),n("p",null,[s("\u5173\u95ED\u4F2A\u7EC8\u7AEF\u65F6\uFF0C\u9700\u8981\u5BF9\u5B50\u8FDB\u7A0B\u53D1\u9001"),n("code",null,"SIGHUP"),s("\uFF0C\u901A\u77E5\u5176\u7EC8\u7AEF\u5C06\u5173\u95ED\u3002")]),n("p",null,[s("\u4E0A\u8FF0\u6D41\u7A0B\u7F16\u5199\u5B8C\u540E\uFF0C\u4F7F\u7528"),n("code",null,"nan"),s("wrap \u4E00\u5C42\u540E\uFF0C\u5373\u53EF\u6210\u4E3A addon\u3002Node.js \u670D\u52A1\u83B7\u53D6\u5230\u4F2A\u7EC8\u7AEF\u4E3B\u8BBE\u5907 fd \u540E\uFF0C\u5C01\u88C5\u4E3A\u4E00\u4E2A Stream\u3002\u56E0\u4E3A node.js \u4F7F\u7528\u7684\u662F\u5F02\u6B65 I/O\uFF0C\u4E0D\u80FD\u76F4\u63A5\u963B\u585E\u3002")]),n("pre",{class:"language-cpp"},[n("code",{class:"language-cpp"},[n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"fd_add_cloexec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"int"),s(" fd"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"int"),s(" flags"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("flags "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"fcntl"),n("span",{class:"token punctuation"},"("),s("fd"),n("span",{class:"token punctuation"},","),s(" F_GETFD"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"fcntl"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    flags `),n("span",{class:"token operator"},"|="),s(" FD_CLOEXEC"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"fcntl"),n("span",{class:"token punctuation"},"("),s("fd"),n("span",{class:"token punctuation"},","),s(" F_SETFD"),n("span",{class:"token punctuation"},","),s(" flags"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"create_pts"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"int"),n("span",{class:"token operator"},"*"),s(" child_pid_ptr"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"int"),s(" master_tty_fd"),n("span",{class:"token punctuation"},","),s(" slave_tty_fd"),n("span",{class:"token punctuation"},","),s(" child_pid"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"char"),s(" slave_tty_name"),n("span",{class:"token punctuation"},"["),s("FILENAME_MAX"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"*"),s("str"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"*"),s("shell"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token class-name"},"sigaction"),s(" sia"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("child_pid_ptr "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        child_pid_ptr `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),s("child_pid"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("master_tty_fd "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"posix_openpt"),n("span",{class:"token punctuation"},"("),s("O_RDWR "),n("span",{class:"token operator"},"|"),s(" O_NOCTTY"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"posix_openpt"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"fd_add_cloexec"),n("span",{class:"token punctuation"},"("),s("master_tty_fd"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"fd_add_cloexec"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("str "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"ptsname"),n("span",{class:"token punctuation"},"("),s("master_tty_fd"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ptsname"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token function"},"strcpy"),n("span",{class:"token punctuation"},"("),s("slave_tty_name"),n("span",{class:"token punctuation"},","),s(" str"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"unlockpt"),n("span",{class:"token punctuation"},"("),s("master_tty_fd"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"unlockpt"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("shell "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getenv"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"SHELL"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},")"),s(`
        shell `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"char"),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},")"),n("span",{class:"token string"},'"/bin/sh"'),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token function"},"memset"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("sia"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"sizeof"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token class-name"},"sigaction"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token function"},"sigemptyset"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("sia"),n("span",{class:"token punctuation"},"."),s("sa_mask"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    sia`),n("span",{class:"token punctuation"},"."),s("sa_flags "),n("span",{class:"token operator"},"="),s(" SA_RESETHAND "),n("span",{class:"token operator"},"|"),s(" SA_NOCLDWAIT"),n("span",{class:"token punctuation"},";"),s(`
    sia`),n("span",{class:"token punctuation"},"."),s("sa_handler "),n("span",{class:"token operator"},"="),s(" SIG_DFL"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"sigaction"),n("span",{class:"token punctuation"},"("),s("SIGCHLD"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("sia"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"sigaction"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"*"),s("child_pid_ptr"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"fork"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"*"),s("child_pid_ptr"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"fork"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"// child process"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"*"),s("child_pid_ptr"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"setsid"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token function"},"err_exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"setsid"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"close"),n("span",{class:"token punctuation"},"("),s("master_tty_fd"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token function"},"err_exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"close"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("slave_tty_fd "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"open"),n("span",{class:"token punctuation"},"("),s("slave_tty_name"),n("span",{class:"token punctuation"},","),s(" O_RDWR"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token function"},"err_exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"open"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"dup2"),n("span",{class:"token punctuation"},"("),s("slave_tty_fd"),n("span",{class:"token punctuation"},","),s(" STDIN_FILENO"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token function"},"err_exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dup2"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"dup2"),n("span",{class:"token punctuation"},"("),s("slave_tty_fd"),n("span",{class:"token punctuation"},","),s(" STDOUT_FILENO"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token function"},"err_exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dup2"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"dup2"),n("span",{class:"token punctuation"},"("),s("slave_tty_fd"),n("span",{class:"token punctuation"},","),s(" STDERR_FILENO"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token function"},"err_exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"dup2"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token function"},"execlp"),n("span",{class:"token punctuation"},"("),s("shell"),n("span",{class:"token punctuation"},","),s(" shell"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"char"),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},")"),n("span",{class:"token constant"},"NULL"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token function"},"err_exit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"execlp"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" master_tty_fd"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"kill_pts_child"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"int"),s(" child_pid"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"kill"),n("span",{class:"token punctuation"},"("),s("child_pid"),n("span",{class:"token punctuation"},","),s(" SIGHUP"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token function"},"resize_pts"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"int"),s(" pts_fd"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"short"),s(" rows"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"unsigned"),s(),n("span",{class:"token keyword"},"short"),s(" cols"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token class-name"},"winsize"),s(" wsize"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"ioctl"),n("span",{class:"token punctuation"},"("),s("pts_fd"),n("span",{class:"token punctuation"},","),s(" TIOCGWINSZ"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("wsize"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ioctl"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    wsize`),n("span",{class:"token punctuation"},"."),s("ws_row "),n("span",{class:"token operator"},"="),s(" rows"),n("span",{class:"token punctuation"},";"),s(`
    wsize`),n("span",{class:"token punctuation"},"."),s("ws_col "),n("span",{class:"token operator"},"="),s(" cols"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"ioctl"),n("span",{class:"token punctuation"},"("),s("pts_fd"),n("span",{class:"token punctuation"},","),s(" TIOCSWINSZ"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),s("wsize"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"pts_fatal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ioctl"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("pre",{class:"language-javascript"},[n("code",{class:"language-javascript"},[n("span",{class:"token keyword"},"const"),s(" stream "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"stream"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(" fs "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"fs"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(" ptsAddon "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"./pts-addon"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"PtsStream"),s(),n("span",{class:"token keyword"},"extends"),s(),n("span",{class:"token class-name"},[s("stream"),n("span",{class:"token punctuation"},"."),s("Duplex")]),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"options"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"super"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" ptsFd"),n("span",{class:"token punctuation"},","),s(" childPid "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(" ptsAddon"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"createPts"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("ptsFd "),n("span",{class:"token operator"},"="),s(" ptsFd"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("childPid "),n("span",{class:"token operator"},"="),s(" childPid"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token function"},"_destroy"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    fs`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"close"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("ptsFd"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    ptsAddon`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"killPtsChild"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("childPid"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token function"},"_read"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"size"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    fs`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"read"),n("span",{class:"token punctuation"},"("),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("ptsFd"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token literal-property property"},"length"),n("span",{class:"token operator"},":"),s(" size"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("err"),n("span",{class:"token punctuation"},","),s(" bytesRead"),n("span",{class:"token punctuation"},","),s(" buffer")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("err "),n("span",{class:"token operator"},"||"),s(" bytesRead "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"destroy"),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
          `),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),s("Buffer"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"from"),n("span",{class:"token punctuation"},"("),s("buffer"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"slice"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(" bytesRead"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token function"},"_write"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("chunk"),n("span",{class:"token punctuation"},","),s(" encoding"),n("span",{class:"token punctuation"},","),s(" callback")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    fs`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"write"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("ptsFd"),n("span",{class:"token punctuation"},","),s(" chunk"),n("span",{class:"token punctuation"},","),s(" callback"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token function"},"resize"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("rows"),n("span",{class:"token punctuation"},","),s(" cols")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    ptsAddon`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"resizePts"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("ptsFd"),n("span",{class:"token punctuation"},","),s(" rows"),n("span",{class:"token punctuation"},","),s(" cols"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

module`),n("span",{class:"token punctuation"},"."),s("exports "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(" PtsStream "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("h2",{id:"%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C",tabindex:"-1"},"\u5B9E\u73B0\u6548\u679C"),n("p",null,[s("Github \u4ED3\u5E93 "),n("a",{href:"https://github.com/ChenKS12138/web-pty"},"https://github.com/ChenKS12138/web-pty")]),n("p",null,[n("img",{src:i,alt:"result"})]),n("p",null,[n("img",{src:r,alt:"result-vim"})]),n("p",null,"\u5BF9\u7A97\u53E3\u7684\u8C03\u6574\u505A\u4E86\u9002\u914D\uFF0C\u56E0\u6B64 vim \u7B49\u7F16\u8F91\u5668\u4E5F\u53EF\u4EE5\u6B63\u5E38\u5DE5\u4F5C\u3002"),n("h1",{id:"%E7%BB%93%E8%AF%AD",tabindex:"-1"},"\u7ED3\u8BED"),n("p",null,"\u4E4B\u524D\u9047\u5230 linux \u65B9\u9762\u7684\u95EE\u9898\uFF0C\u5927\u90FD\u662F\u901A\u8FC7\u76F4\u63A5 Google \u641C\u7D22\u62A5\u9519\u4FE1\u606F\u627E\u5230\u89E3\u51B3\u65B9\u6848\u3002\u770B\u5B8C tlpi \u4E86\u89E3\u4E86\u8FD9\u4E9B\u6982\u5FF5\u540E\u5BF9 linux \u5185\u6838\u5982\u4F55\u8FD0\u4F5C\u6709\u4E86\u57FA\u672C\u7684\u8BA4\u77E5\uFF0C\u5904\u7406\u95EE\u9898\u65F6\u5FC3\u4E2D\u53EF\u4EE5\u6709\u4E2A\u6A21\u578B\uFF0C\u80FD\u591F\u7406\u89E3\u5185\u6838\u4E2D\u53D1\u751F\u7684\u4E8B\u4EF6\uFF0C\u6392\u67E5\u95EE\u9898\u65F6\u66F4\u6709\u9488\u5BF9\u6027\u3002\u8FD9\u4E5F\u662F\u6211\u8BA4\u4E3A\u5DE5\u7A0B\u5E08\u533A\u522B\u4E8E\u5176\u4ED6\u666E\u901A\u4EBA\u7684\u5730\u65B9\uFF0C\u5176\u4ED6\u4EBA\u53EA\u80FD\u770B\u5230\u8868\u8C61\uFF0C\u4F46\u662F\u5DE5\u7A0B\u5E08\u7406\u89E3\u8868\u8C61\u80CC\u540E\u7684\u7CFB\u7EDF\u8FD0\u4F5C\u903B\u8F91\u3002"),n("h1",{id:"%E5%8F%82%E8%80%83%E5%BC%95%E7%94%A8",tabindex:"-1"},"\u53C2\u8003\u5F15\u7528"),n("ul",null,[n("li",null,[s("[1] "),n("a",{href:"https://man7.org/tlpi/"},"https://man7.org/tlpi/")]),n("li",null,[s("[2] "),n("a",{href:"https://zhuanlan.zhihu.com/p/97018747"},"https://zhuanlan.zhihu.com/p/97018747")])])],-1),g="\u52A8\u624B\u5199\u4E00\u4E2Aweb pty",b="default description",E="2021-11-12T18:02:39.000Z",x=["Web"],A="./1.png",F=[{depth:1,title:"\u524D\u8A00",children:[]},{depth:1,title:"\u4EC0\u4E48\u662F\u7EC8\u7AEF",children:[]},{depth:1,title:"web \u7EC8\u7AEF\u7684\u5B9E\u73B0",children:[{depth:2,title:"\u5B9E\u73B0\u76EE\u6807\u53CA\u65B9\u5F0F",children:[]},{depth:2,title:"\u5B9E\u73B0\u539F\u7406",children:[]},{depth:2,title:"\u5B9E\u73B0\u6548\u679C",children:[]}]},{depth:1,title:"\u7ED3\u8BED",children:[]},{depth:1,title:"\u53C2\u8003\u5F15\u7528",children:[]}],B=[{property:"og:title",name:"twitter:title",itemprop:"title",content:"\u52A8\u624B\u5199\u4E00\u4E2Aweb pty"},{property:"og:description",name:"twitter:description",itemprop:"description",content:"default description"}],S={__name:"content",setup(f,{expose:a}){const t={title:"\u52A8\u624B\u5199\u4E00\u4E2Aweb pty",description:"default description",date:"2021-11-12T18:02:39.000Z",tags:["Web"],coverImage:"./1.png",headings:[{depth:1,title:"\u524D\u8A00",children:[]},{depth:1,title:"\u4EC0\u4E48\u662F\u7EC8\u7AEF",children:[]},{depth:1,title:"web \u7EC8\u7AEF\u7684\u5B9E\u73B0",children:[{depth:2,title:"\u5B9E\u73B0\u76EE\u6807\u53CA\u65B9\u5F0F",children:[]},{depth:2,title:"\u5B9E\u73B0\u539F\u7406",children:[]},{depth:2,title:"\u5B9E\u73B0\u6548\u679C",children:[]}]},{depth:1,title:"\u7ED3\u8BED",children:[]},{depth:1,title:"\u53C2\u8003\u5F15\u7528",children:[]}],meta:[{property:"og:title",name:"twitter:title",itemprop:"title",content:"\u52A8\u624B\u5199\u4E00\u4E2Aweb pty"},{property:"og:description",name:"twitter:description",itemprop:"description",content:"default description"}]};return a({frontmatter:t}),(_,y)=>{const o=p;return u(),c(o,{frontmatter:t},{default:e(()=>[d]),_:1})}}};export{A as coverImage,E as date,S as default,b as description,F as headings,B as meta,x as tags,g as title};
